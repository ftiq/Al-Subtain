<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">

        <record id="uom_categ_temperature_ap" model="uom.category">
            <field name="name">temperature</field>
        </record>

        <record id="uom_categ_penetration_ap" model="uom.category">
            <field name="name">penetration</field>
        </record>

        <record id="uom_categ_elongation_ap" model="uom.category">
            <field name="name">elongation</field>
        </record>

        <record id="uom_categ_softening_ap" model="uom.category">
            <field name="name">softening</field>
        </record>

        <record id="uom_celsius_ap" model="uom.uom">
            <field name="name">°C</field>
            <field name="category_id" ref="uom_categ_temperature_ap"/>
            <field name="factor" eval="1.0"/>
            <field name="uom_type">reference</field>
        </record>

        <record id="uom_dmm_ap" model="uom.uom">
            <field name="name">dmm</field>
            <field name="category_id" ref="uom_categ_penetration_ap"/>
            <field name="factor" eval="1.0"/>
            <field name="uom_type">reference</field>
        </record>

        <record id="uom_centimeter_ap" model="uom.uom">
            <field name="name">سم</field>
            <field name="category_id" ref="uom_categ_elongation_ap"/>
            <field name="factor" eval="1.0"/>
            <field name="uom_type">reference</field>
        </record>

        <record id="uom_softening_degree_ap" model="uom.uom">
            <field name="name">°C</field>
            <field name="category_id" ref="uom_categ_softening_ap"/>
            <field name="factor" eval="1.0"/>
            <field name="uom_type">reference</field>
        </record>

        <record id="template_bitumen_penetration" model="lab.test.template">
            <field name="name">Penetration test for bitumen</field>
            <field name="code">BITUMEN_PENETRATION</field>
            <field name="description">Penetration test for bitumen</field>
            <field name="standard_code">ASTM D5, AASHTO T49</field>
            <field name="industry_type">asphalt</field>
            <field name="state">active</field>
            <field name="sequence">10</field>
        </record>

        <record id="crit_pentest_1" model="lab.test.criterion">
            <field name="template_id" ref="template_bitumen_penetration"/>
            <field name="name">Reading 1</field>
            <field name="code">PENTEST_1</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="uom_dmm_ap"/>
            <field name="min_value">0</field>
            <field name="max_value">0</field>
            <field name="target_value">0</field>
            <field name="sequence">10</field>
            <field name="is_required">True</field>
            <field name="is_critical">False</field>
            <field name="is_global">False</field>
            <field name="is_summary_field">False</field>
        </record>

        <record id="crit_pentest_2" model="lab.test.criterion">
            <field name="template_id" ref="template_bitumen_penetration"/>
            <field name="name">Reading 2</field>
            <field name="code">PENTEST_2</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="uom_dmm_ap"/>
            <field name="min_value">0</field>
            <field name="max_value">0</field>
            <field name="target_value">0</field>
            <field name="sequence">11</field>
            <field name="is_required">True</field>
            <field name="is_critical">False</field>
            <field name="is_global">False</field>
            <field name="is_summary_field">False</field>
        </record>

        <record id="crit_pentest_3" model="lab.test.criterion">
            <field name="template_id" ref="template_bitumen_penetration"/>
            <field name="name">Reading 3</field>
            <field name="code">PENTEST_3</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="uom_dmm_ap"/>
            <field name="min_value">0</field>
            <field name="max_value">0</field>
            <field name="target_value">0</field>
            <field name="sequence">12</field>
            <field name="is_required">True</field>
            <field name="is_critical">False</field>
            <field name="is_global">False</field>
            <field name="is_summary_field">False</field>
        </record>

        <record id="crit_pentest_4" model="lab.test.criterion">
            <field name="template_id" ref="template_bitumen_penetration"/>
            <field name="name">Reading 4</field>
            <field name="code">PENTEST_4</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="uom_dmm_ap"/>
            <field name="min_value">0</field>
            <field name="max_value">0</field>
            <field name="target_value">0</field>
            <field name="sequence">13</field>
            <field name="is_required">True</field>
            <field name="is_critical">False</field>
            <field name="is_global">False</field>
            <field name="is_summary_field">False</field>
        </record>

        <record id="crit_pentest_5" model="lab.test.criterion">
            <field name="template_id" ref="template_bitumen_penetration"/>
            <field name="name">Reading 5</field>
            <field name="code">PENTEST_5</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="uom_dmm_ap"/>
            <field name="min_value">0</field>
            <field name="max_value">0</field>
            <field name="target_value">0</field>
            <field name="sequence">14</field>
            <field name="is_required">True</field>
            <field name="is_critical">False</field>
            <field name="is_global">False</field>
            <field name="is_summary_field">False</field>
        </record>

        <record id="crit_pentest_6" model="lab.test.criterion">
            <field name="template_id" ref="template_bitumen_penetration"/>
            <field name="name">Reading 6</field>
            <field name="code">PENTEST_6</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="uom_dmm_ap"/>
            <field name="min_value">0</field>
            <field name="max_value">0</field>
            <field name="target_value">0</field>
            <field name="sequence">15</field>
            <field name="is_required">True</field>
            <field name="is_critical">False</field>
            <field name="is_global">False</field>
            <field name="is_summary_field">False</field>
        </record>

        <record id="crit_pentest_7" model="lab.test.criterion">
            <field name="template_id" ref="template_bitumen_penetration"/>
            <field name="name">Reading 7</field>
            <field name="code">PENTEST_7</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="uom_dmm_ap"/>
            <field name="min_value">0</field>
            <field name="max_value">0</field>
            <field name="target_value">0</field>
            <field name="sequence">16</field>
            <field name="is_required">True</field>
            <field name="is_critical">False</field>
            <field name="is_global">False</field>
            <field name="is_summary_field">False</field>
        </record>

        <record id="crit_pentest_8" model="lab.test.criterion">
            <field name="template_id" ref="template_bitumen_penetration"/>
            <field name="name">Reading 8</field>
            <field name="code">PENTEST_8</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="uom_dmm_ap"/>
            <field name="min_value">0</field>
            <field name="max_value">0</field>
            <field name="target_value">0</field>
            <field name="sequence">17</field>
            <field name="is_required">True</field>
            <field name="is_critical">False</field>
            <field name="is_global">False</field>
            <field name="is_summary_field">False</field>
        </record>

        <record id="crit_pentest_9" model="lab.test.criterion">
            <field name="template_id" ref="template_bitumen_penetration"/>
            <field name="name">Reading 9</field>
            <field name="code">PENTEST_9</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="uom_dmm_ap"/>
            <field name="min_value">0</field>
            <field name="max_value">0</field>
            <field name="target_value">0</field>
            <field name="sequence">18</field>
            <field name="is_required">True</field>
            <field name="is_critical">False</field>
            <field name="is_global">False</field>
            <field name="is_summary_field">False</field>
        </record>

        <record id="crit_pentest_avg" model="lab.test.criterion">
            <field name="template_id" ref="template_bitumen_penetration"/>
            <field name="name">Average penetration</field>
            <field name="code">PENTEST_AVG</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="uom_dmm_ap"/>
            <field name="min_value">0</field>
            <field name="max_value">0</field>
            <field name="target_value">0</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula"># Calculate average penetration based on available readings
def safe_value(val):
    if isinstance(val, (list, tuple)) and len(val) > 0:
        return val[0]
    elif isinstance(val, (int, float)):
        return val
    else:
        return 0

values = [safe_value(PENTEST_1), safe_value(PENTEST_2), safe_value(PENTEST_3), safe_value(PENTEST_4), safe_value(PENTEST_5), safe_value(PENTEST_6), safe_value(PENTEST_7), safe_value(PENTEST_8), safe_value(PENTEST_9)]
valid_values = [v for v in values if v > 0]
result = sum(valid_values) / len(valid_values) if valid_values else 0</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_pentest_1'), ref('crit_pentest_2'), ref('crit_pentest_3'), ref('crit_pentest_4'), ref('crit_pentest_5'), ref('crit_pentest_6'), ref('crit_pentest_7'), ref('crit_pentest_8'), ref('crit_pentest_9')])]"/>
            <field name="sequence">19</field>
            <field name="is_required">False</field>
            <field name="is_critical">True</field>
            <field name="is_global">False</field>
            <field name="is_summary_field">True</field>
        </record>

        <record id="template_bitumen_flash_fire" model="lab.test.template">
            <field name="name">Flash point test for bitumen</field>
            <field name="code">BITUMEN_FLASH_FIRE</field>
            <field name="description">Flash point test for bitumen</field>
            <field name="standard_code">ASTM D92, AASHTO T48</field>
            <field name="industry_type">asphalt</field>
            <field name="state">active</field>
            <field name="sequence">20</field>
        </record>

        <record id="crit_flash_point" model="lab.test.criterion">
            <field name="template_id" ref="template_bitumen_flash_fire"/>
            <field name="name">Flash point</field>
            <field name="code">FLASH_POINT</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="uom_celsius_ap"/>
            <field name="min_value">0</field>
            <field name="max_value">0</field>
            <field name="target_value">0</field>
            <field name="sequence">10</field>
            <field name="is_required">True</field>
            <field name="is_critical">True</field>
            <field name="is_global">False</field>
            <field name="is_summary_field">True</field>
        </record>


        <record id="template_bitumen_ductility" model="lab.test.template">
            <field name="name">Ductility test for bitumen</field>
            <field name="code">BITUMEN_DUCTILITY</field>
            <field name="description">Ductility test for bitumen</field>
            <field name="standard_code">ASTM D113, AASHTO T51</field>
            <field name="industry_type">asphalt</field>
            <field name="state">active</field>
            <field name="sequence">30</field>
        </record>

        <record id="crit_ductility_1" model="lab.test.criterion">
            <field name="template_id" ref="template_bitumen_ductility"/>
            <field name="name">Reading 1</field>
            <field name="code">DUCTILITY_TEST_1</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="uom_centimeter_ap"/>
            <field name="min_value">0</field>
            <field name="max_value">0</field>
            <field name="target_value">0</field>
            <field name="sequence">10</field>
            <field name="is_required">True</field>
            <field name="is_critical">False</field>
            <field name="is_global">False</field>
            <field name="is_summary_field">False</field>
        </record>

        <record id="crit_ductility_2" model="lab.test.criterion">
            <field name="template_id" ref="template_bitumen_ductility"/>
            <field name="name">Reading 2</field>
            <field name="code">DUCTILITY_TEST_2</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="uom_centimeter_ap"/>
            <field name="min_value">0</field>
            <field name="max_value">0</field>
            <field name="target_value">0</field>
            <field name="sequence">11</field>
            <field name="is_required">True</field>
            <field name="is_critical">False</field>
            <field name="is_global">False</field>
            <field name="is_summary_field">False</field>
        </record>

        <record id="crit_ductility_3" model="lab.test.criterion">
            <field name="template_id" ref="template_bitumen_ductility"/>
            <field name="name">Reading 3</field>
            <field name="code">DUCTILITY_TEST_3</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="uom_centimeter_ap"/>
            <field name="min_value">0</field>
            <field name="max_value">0</field>
            <field name="target_value">0</field>
            <field name="sequence">12</field>
            <field name="is_required">True</field>
            <field name="is_critical">False</field>
            <field name="is_global">False</field>
            <field name="is_summary_field">False</field>
        </record>

        <record id="crit_ductility_avg" model="lab.test.criterion">
            <field name="template_id" ref="template_bitumen_ductility"/>
            <field name="name">Average ductility</field>
            <field name="code">DUCTILITY_TEST_AVG</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="uom_centimeter_ap"/>
            <field name="min_value">0</field>
            <field name="max_value">0</field>
            <field name="target_value">0</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula"># Calculate average ductility based on available readings
def safe_value(val):
    if isinstance(val, (list, tuple)) and len(val) > 0:
        return val[0]
    elif isinstance(val, (int, float)):
        return val
    else:
        return 0

values = [safe_value(DUCTILITY_TEST_1), safe_value(DUCTILITY_TEST_2), safe_value(DUCTILITY_TEST_3)]
valid_values = [v for v in values if v > 0]
result = sum(valid_values) / len(valid_values) if valid_values else 0</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_ductility_1'), ref('crit_ductility_2'), ref('crit_ductility_3')])]"/>
            <field name="sequence">13</field>
            <field name="is_required">False</field>
            <field name="is_critical">True</field>
            <field name="is_global">False</field>
            <field name="is_summary_field">True</field>
        </record>

        <record id="template_bitumen_softening" model="lab.test.template">
            <field name="name">Softening point test for bitumen</field>
            <field name="code">BITUMEN_SOFTENING</field>
            <field name="description">Softening point test for bitumen</field>
            <field name="standard_code">ASTM D36, AASHTO T53</field>
            <field name="industry_type">asphalt</field>
            <field name="state">active</field>
            <field name="sequence">40</field>
        </record>

        <record id="crit_softening_1" model="lab.test.criterion">
            <field name="template_id" ref="template_bitumen_softening"/>
            <field name="name">Reading 1</field>
            <field name="code">SOFTENING_1</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="uom_softening_degree_ap"/>
            <field name="min_value">0</field>
            <field name="max_value">0</field>
            <field name="target_value">0</field>
            <field name="sequence">10</field>
            <field name="is_required">True</field>
            <field name="is_critical">False</field>
            <field name="is_global">False</field>
            <field name="is_summary_field">False</field>
        </record>

        <record id="crit_softening_2" model="lab.test.criterion">
            <field name="template_id" ref="template_bitumen_softening"/>
            <field name="name">Reading 2</field>
            <field name="code">SOFTENING_2</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="uom_softening_degree_ap"/>
            <field name="min_value">0</field>
            <field name="max_value">0</field>
            <field name="target_value">0</field>
            <field name="sequence">12</field>
            <field name="is_required">True</field>
            <field name="is_critical">False</field>
            <field name="is_global">False</field>
            <field name="is_summary_field">False</field>
        </record>

        <record id="crit_softening_avg" model="lab.test.criterion">
            <field name="template_id" ref="template_bitumen_softening"/>
            <field name="name">Average softening point</field>
            <field name="code">SOFTENING_AVG</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="uom_softening_degree_ap"/>
            <field name="min_value">0</field>
            <field name="max_value">0</field>
            <field name="target_value">0</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">
def safe_value(val):
    if isinstance(val, (list, tuple)) and len(val) > 0:
        return val[0]
    elif isinstance(val, (int, float)):
        return val
    else:
        return 0

val1 = safe_value(SOFTENING_1)
val2 = safe_value(SOFTENING_2)
result = (val1 + val2) / 2 if val1 and val2 else 0
            </field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_softening_1'), ref('crit_softening_2')])]"/>
            <field name="sequence">13</field>
            <field name="is_required">False</field>
            <field name="is_critical">False</field>
            <field name="is_global">False</field>
            <field name="is_summary_field">True</field>
        </record>


        <record id="crit_softening_result" model="lab.test.criterion">
            <field name="template_id" ref="template_bitumen_softening"/>
            <field name="name">Softening point result</field>
            <field name="code">SOFTENING_RESULT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="uom_softening_degree_ap"/>
            <field name="min_value">-1</field>
            <field name="max_value">110</field>
            <field name="target_value">50</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">
def safe_value(val):
    if isinstance(val, (list, tuple)) and len(val) > 0:
        return val[0]
    elif isinstance(val, (int, float)):
        return val
    else:
        return 0

val1 = safe_value(SOFTENING_1)
val2 = safe_value(SOFTENING_2)
avg_temp = (val1 + val2) / 2 if val1 and val2 else 0

result = evaluate_softening_level(avg_temp) if avg_temp else 0
            </field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_softening_1'), ref('crit_softening_2')])]"/>
            <field name="sequence">14</field>
            <field name="is_required">False</field>
            <field name="is_critical">True</field>
            <field name="is_global">False</field>
            <field name="is_summary_field">True</field>
        </record>



        <record id="bitumen_test_flow_template" model="lab.test.flow.template">
            <field name="name">Complete bitumen test flow</field>
            <field name="description">Penetration → Flash point and ignition → Ductility → Softening point</field>
            <field name="allow_parallel_tests" eval="True"/>
        </record>

        <record id="bitumen_test_flow_stage1" model="lab.test.flow.template.line">
            <field name="template_id" ref="bitumen_test_flow_template"/>
            <field name="sequence">10</field>
            <field name="test_template_id" ref="template_bitumen_penetration"/>
            <field name="sample_qty">1</field>
        </record>

        <record id="bitumen_test_flow_stage2" model="lab.test.flow.template.line">
            <field name="template_id" ref="bitumen_test_flow_template"/>
            <field name="sequence">20</field>
            <field name="test_template_id" ref="template_bitumen_flash_fire"/>
            <field name="sample_qty">1</field>
        </record>

        <record id="bitumen_test_flow_stage3" model="lab.test.flow.template.line">
            <field name="template_id" ref="bitumen_test_flow_template"/>
            <field name="sequence">30</field>
            <field name="test_template_id" ref="template_bitumen_ductility"/>
            <field name="sample_qty">1</field>
        </record>

        <record id="bitumen_test_flow_stage4" model="lab.test.flow.template.line">
            <field name="template_id" ref="bitumen_test_flow_template"/>
            <field name="sequence">40</field>
            <field name="test_template_id" ref="template_bitumen_softening"/>
            <field name="sample_qty">1</field>
        </record>


        <record id="bitumen_surfacing_type" model="lab.sample.type">
            <field name="name">Bitumen Surfacing</field>
            <field name="code">BITUMEN_SURFACING</field>
            <field name="description">Bitumen for surfacing</field>
            <field name="sequence">40</field>
        </record>

        <record id="bitumen_base_type" model="lab.sample.type">
            <field name="name">Bitumen Base</field>
            <field name="code">BITUMEN_BASE</field>
            <field name="description">Bitumen for base</field>
            <field name="sequence">41</field>
        </record>

        <record id="bitumen_surfacing_subtype_standard" model="lab.sample.subtype">
            <field name="name">Bitumen Surfacing Standard</field>
            <field name="code">SURFACING_STANDARD</field>
            <field name="sample_type_id" ref="bitumen_surfacing_type"/>
            <field name="description">Bitumen Surfacing Standard for road use</field>
            <field name="sequence">10</field>
        </record>

        <record id="bitumen_surfacing_subtype_modified" model="lab.sample.subtype">
            <field name="name">Bitumen Surfacing Modified</field>
            <field name="code">SURFACING_MODIFIED</field>
            <field name="sample_type_id" ref="bitumen_surfacing_type"/>
            <field name="description">Bitumen Surfacing Modified with polymer</field>
            <field name="sequence">20</field>
        </record>

        <record id="bitumen_base_subtype_standard" model="lab.sample.subtype">
            <field name="name">Bitumen Base Standard</field>
            <field name="code">BASE_STANDARD</field>
            <field name="sample_type_id" ref="bitumen_base_type"/>
            <field name="description">Bitumen Base Standard for road use</field>
            <field name="sequence">10</field>
        </record>

        <record id="bitumen_base_subtype_heavy" model="lab.sample.subtype">
            <field name="name">Bitumen Base Heavy</field>
            <field name="code">BASE_HEAVY</field>
            <field name="sample_type_id" ref="bitumen_base_type"/>
            <field name="description">Bitumen Base Heavy for heavy loads</field>
            <field name="sequence">20</field>
        </record>


        <record id="product_bitumen_surfacing_sample" model="product.template">
            <field name="name">Bitumen Surfacing - Sample</field>
            <field name="type">consu</field>
            <field name="is_sample_product">True</field>
            <field name="tracking">serial</field>
            <field name="sample_type_id" ref="bitumen_surfacing_type"/>
            <field name="test_flow_template_id" ref="bitumen_test_flow_template"/>
            <field name="categ_id" ref="product.product_category_all"/>
        </record>

        <record id="product_bitumen_base_sample" model="product.template">
            <field name="name">Bitumen Base - Sample</field>
            <field name="type">consu</field>
            <field name="is_sample_product">True</field>
            <field name="tracking">serial</field>
            <field name="sample_type_id" ref="bitumen_base_type"/>
            <field name="test_flow_template_id" ref="bitumen_test_flow_template"/>
            <field name="categ_id" ref="product.product_category_all"/>
        </record>

    </data>
</odoo>