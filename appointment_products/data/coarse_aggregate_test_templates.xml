<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">

        <record id="aggregate_sample_type" model="lab.sample.type">
            <field name="name">ركام</field>
            <field name="code">AGG</field>
            <field name="description">أنواع الركام (ناعم/خشن)</field>
            <field name="sequence">20</field>
        </record>

        <record id="template_coarse_aggregate_sieve" model="lab.test.template">
            <field name="name">فحص الركام الخشن (بحص) تدرج فقط</field>
            <field name="code">COARSE_SIEVE</field>
            <field name="description">تحليل تدرج الركام الخشن باستخدام المناخل القياسية وحساب النسب المحتجزة والمارة</field>
            <field name="standard_code">IQS 30 - 1984</field>
            <field name="industry_type">aggregate</field>
            <field name="template_category">construction</field>
            <field name="state">active</field>
            <field name="sequence">15</field>
        </record>

        <record id="crit_coarse_orig_wt_gm" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">وزن العينة الأصلية الجافة (غم)</field>
            <field name="code">ORIG_WT_GM</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="appointment_products.uom_gram_ap"/>
            <field name="sequence">5</field>
            <field name="min_value">0</field>
            <field name="is_required">True</field>
            <field name="is_global">True</field>
        </record>

        <record id="crit_coarse_washed_wt_gm" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">الوزن بعد غسل العينة (غم)</field>
            <field name="code">WASHED_WT_GM</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="appointment_products.uom_gram_ap"/>
            <field name="sequence">6</field>
            <field name="min_value">0</field>
            <field name="is_required">True</field>
            <field name="is_global">True</field>
        </record>

        <!-- % المواد المارة 0.075 mm (بعد الغسل) = ((الوزن قبل الغسل - الوزن بعد الغسل)/الوزن قبل الغسل)*100 -->
        <record id="crit_fines_0_075mm_wash_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المواد المارة 0.075 mm (بعد الغسل)</field>
            <field name="code">FINES_0_075MM_WASH_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">8</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="is_global">True</field>
            <field name="computation_formula">result = ((ORIG_WT_GM - WASHED_WT_GM) / ORIG_WT_GM * 100) if ORIG_WT_GM else 0</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_coarse_orig_wt_gm'), ref('crit_coarse_washed_wt_gm')])]"/>
        </record>

        <!-- Helper computed: مجموع الأوزان المحتجزة للتحقق -->
        <record id="crit_coarse_total_ret_gm" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">مجموع الأوزان المحتجزة (غم)</field>
            <field name="code">TOTAL_RET_GM</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_gram_ap"/>
            <field name="sequence">2000</field>
            <field name="min_value">0</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = (RET_75MM_GM or 0) + (RET_63MM_GM or 0) + (RET_37_5MM_GM or 0) + (RET_20MM_GM or 0) + (RET_14MM_GM or 0) + (RET_10MM_GM or 0) + (RET_5MM_GM or 0) + (RET_2_36MM_GM or 0) + (RET_0_075MM_GM or 0)</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[])]"/>
        </record>

        <record id="crit_coarse_balance_gm" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">فرق الوزن (غم) = وزن أصلي - مجموع المحتجز</field>
            <field name="code">BALANCE_GM</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_gram_ap"/>
            <field name="sequence">2010</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = (ORIG_WT_GM or 0) - (TOTAL_RET_GM or 0)</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_coarse_orig_wt_gm'), ref('crit_coarse_total_ret_gm')])]"/>
            <field name="help_text">ينبغي أن يكون الفرق صغيراً (نتيجة الفقد أثناء الغربلة)</field>
        </record>

        <!-- 75 mm (3 in) -->
        <record id="crit_ret_75mm_gm" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">منخل (غم) - 75 mm (3 in)</field>
            <field name="code">RET_75MM_GM</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="appointment_products.uom_gram_ap"/>
            <field name="sequence">10</field>
            <field name="min_value">0</field>
            <field name="is_required">False</field>
        </record>
        <record id="crit_ret_75mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المحتجز - 75 mm</field>
            <field name="code">RET_75MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">11</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = (RET_75MM_GM / ORIG_WT_GM * 100) if ORIG_WT_GM else 0</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_ret_75mm_gm'), ref('crit_coarse_orig_wt_gm')])]"/>
        </record>
        <record id="crit_cum_ret_75mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المحتجز التراكمي - 75 mm</field>
            <field name="code">CUM_RET_75MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">12</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = RET_75MM_PCT or 0</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_ret_75mm_pct')])]"/>
        </record>
        <record id="crit_pass_75mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المار - 75 mm</field>
            <field name="code">PASS_75MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">13</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = 100 - (RET_75MM_PCT or 0)</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_ret_75mm_pct')])]"/>
        </record>

        <!-- 63 mm (2½ in) -->
        <record id="crit_ret_63mm_gm" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">منخل (غم) - 63 mm (2½ in)</field>
            <field name="code">RET_63MM_GM</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="appointment_products.uom_gram_ap"/>
            <field name="sequence">20</field>
            <field name="min_value">0</field>
            <field name="is_required">False</field>
        </record>
        <record id="crit_ret_63mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المحتجز - 63 mm</field>
            <field name="code">RET_63MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">21</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = (RET_63MM_GM / ORIG_WT_GM * 100) if ORIG_WT_GM else 0</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_ret_63mm_gm'), ref('crit_coarse_orig_wt_gm')])]"/>
        </record>
        <record id="crit_cum_ret_63mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المحتجز التراكمي - 63 mm</field>
            <field name="code">CUM_RET_63MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">22</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = (CUM_RET_75MM_PCT or 0) + (RET_63MM_PCT or 0)</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_cum_ret_75mm_pct'), ref('crit_ret_63mm_pct')])]"/>
        </record>
        <record id="crit_pass_63mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المار - 63 mm</field>
            <field name="code">PASS_63MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">23</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = 100 - (RET_63MM_PCT or 0)</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_ret_63mm_pct')])]"/>
        </record>

        <!-- 37.5 mm (1½ in) -->
        <record id="crit_ret_37_5mm_gm" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">منخل (غم) - 37.5 mm (1½ in)</field>
            <field name="code">RET_37_5MM_GM</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="appointment_products.uom_gram_ap"/>
            <field name="sequence">30</field>
            <field name="min_value">0</field>
            <field name="is_required">False</field>
        </record>
        <record id="crit_ret_37_5mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المحتجز - 37.5 mm</field>
            <field name="code">RET_37_5MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">31</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = (RET_37_5MM_GM / ORIG_WT_GM * 100) if ORIG_WT_GM else 0</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_ret_37_5mm_gm'), ref('crit_coarse_orig_wt_gm')])]"/>
        </record>
        <record id="crit_cum_ret_37_5mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المحتجز التراكمي - 37.5 mm</field>
            <field name="code">CUM_RET_37_5MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">32</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = (CUM_RET_63MM_PCT or 0) + (RET_37_5MM_PCT or 0)</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_cum_ret_63mm_pct'), ref('crit_ret_37_5mm_pct')])]"/>
        </record>
        <record id="crit_pass_37_5mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المار - 37.5 mm</field>
            <field name="code">PASS_37_5MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">33</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = 100 - (RET_37_5MM_PCT or 0)</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_ret_37_5mm_pct')])]"/>
        </record>

        <!-- 20 mm -->
        <record id="crit_ret_20mm_gm" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">منخل (غم) - 20 mm</field>
            <field name="code">RET_20MM_GM</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="appointment_products.uom_gram_ap"/>
            <field name="sequence">40</field>
            <field name="min_value">0</field>
            <field name="is_required">False</field>
        </record>
        <record id="crit_ret_20mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المحتجز - 20 mm</field>
            <field name="code">RET_20MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">41</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = (RET_20MM_GM / ORIG_WT_GM * 100) if ORIG_WT_GM else 0</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_ret_20mm_gm'), ref('crit_coarse_orig_wt_gm')])]"/>
        </record>
        <record id="crit_cum_ret_20mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المحتجز التراكمي - 20 mm</field>
            <field name="code">CUM_RET_20MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">42</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = (CUM_RET_37_5MM_PCT or 0) + (RET_20MM_PCT or 0)</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_cum_ret_37_5mm_pct'), ref('crit_ret_20mm_pct')])]"/>
        </record>
        <record id="crit_pass_20mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المار - 20 mm</field>
            <field name="code">PASS_20MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">43</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = 100 - (RET_20MM_PCT or 0)</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_ret_20mm_pct')])]"/>
        </record>

        <!-- 14 mm -->
        <record id="crit_ret_14mm_gm" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">منخل (غم) - 14 mm</field>
            <field name="code">RET_14MM_GM</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="appointment_products.uom_gram_ap"/>
            <field name="sequence">50</field>
            <field name="min_value">0</field>
            <field name="is_required">False</field>
        </record>
        <record id="crit_ret_14mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المحتجز - 14 mm</field>
            <field name="code">RET_14MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">51</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = (RET_14MM_GM / ORIG_WT_GM * 100) if ORIG_WT_GM else 0</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_ret_14mm_gm'), ref('crit_coarse_orig_wt_gm')])]"/>
        </record>
        <record id="crit_cum_ret_14mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المحتجز التراكمي - 14 mm</field>
            <field name="code">CUM_RET_14MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">52</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = (CUM_RET_20MM_PCT or 0) + (RET_14MM_PCT or 0)</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_cum_ret_20mm_pct'), ref('crit_ret_14mm_pct')])]"/>
        </record>
        <record id="crit_pass_14mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المار - 14 mm</field>
            <field name="code">PASS_14MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">53</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = 100 - (RET_14MM_PCT or 0)</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_ret_14mm_pct')])]"/>
        </record>

        <!-- 10 mm -->
        <record id="crit_ret_10mm_gm" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">منخل (غم) - 10 mm</field>
            <field name="code">RET_10MM_GM</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="appointment_products.uom_gram_ap"/>
            <field name="sequence">60</field>
            <field name="min_value">0</field>
            <field name="is_required">False</field>
        </record>
        <record id="crit_ret_10mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المحتجز - 10 mm</field>
            <field name="code">RET_10MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">61</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = (RET_10MM_GM / ORIG_WT_GM * 100) if ORIG_WT_GM else 0</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_ret_10mm_gm'), ref('crit_coarse_orig_wt_gm')])]"/>
        </record>
        <record id="crit_cum_ret_10mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المحتجز التراكمي - 10 mm</field>
            <field name="code">CUM_RET_10MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">62</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = (CUM_RET_14MM_PCT or 0) + (RET_10MM_PCT or 0)</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_cum_ret_14mm_pct'), ref('crit_ret_10mm_pct')])]"/>
        </record>
        <record id="crit_pass_10mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المار - 10 mm</field>
            <field name="code">PASS_10MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">63</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = 100 - (RET_10MM_PCT or 0)</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_ret_10mm_pct')])]"/>
        </record>

        <!-- 5 mm (No.8 per provided sheet) -->
        <record id="crit_ret_5mm_gm" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">منخل (غم) - 5 mm (No.8)</field>
            <field name="code">RET_5MM_GM</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="appointment_products.uom_gram_ap"/>
            <field name="sequence">70</field>
            <field name="min_value">0</field>
            <field name="is_required">False</field>
        </record>
        <record id="crit_ret_5mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المحتجز - 5 mm</field>
            <field name="code">RET_5MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">71</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = (RET_5MM_GM / ORIG_WT_GM * 100) if ORIG_WT_GM else 0</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_ret_5mm_gm'), ref('crit_coarse_orig_wt_gm')])]"/>
        </record>
        <record id="crit_cum_ret_5mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المحتجز التراكمي - 5 mm</field>
            <field name="code">CUM_RET_5MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">72</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = (CUM_RET_10MM_PCT or 0) + (RET_5MM_PCT or 0)</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_cum_ret_10mm_pct'), ref('crit_ret_5mm_pct')])]"/>
        </record>
        <record id="crit_pass_5mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المار - 5 mm</field>
            <field name="code">PASS_5MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">73</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = 100 - (RET_5MM_PCT or 0)</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_ret_5mm_pct')])]"/>
        </record>

        <!-- 2.36 mm -->
        <record id="crit_ret_2_36mm_gm" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">منخل (غم) - 2.36 mm</field>
            <field name="code">RET_2_36MM_GM</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="appointment_products.uom_gram_ap"/>
            <field name="sequence">80</field>
            <field name="min_value">0</field>
            <field name="is_required">False</field>
        </record>
        <record id="crit_ret_2_36mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المحتجز - 2.36 mm</field>
            <field name="code">RET_2_36MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">81</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = (RET_2_36MM_GM / ORIG_WT_GM * 100) if ORIG_WT_GM else 0</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_ret_2_36mm_gm'), ref('crit_coarse_orig_wt_gm')])]"/>
        </record>
        <record id="crit_cum_ret_2_36mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المحتجز التراكمي - 2.36 mm</field>
            <field name="code">CUM_RET_2_36MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">82</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = (CUM_RET_5MM_PCT or 0) + (RET_2_36MM_PCT or 0)</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_cum_ret_5mm_pct'), ref('crit_ret_2_36mm_pct')])]"/>
        </record>
        <record id="crit_pass_2_36mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المار - 2.36 mm</field>
            <field name="code">PASS_2_36MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">83</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = 100 - (RET_2_36MM_PCT or 0)</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_ret_2_36mm_pct')])]"/>
        </record>

        <!-- 0.075 mm (No.200) -->
        <record id="crit_ret_0_075mm_gm" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">منخل (غم) - 0.075 mm (No.200)</field>
            <field name="code">RET_0_075MM_GM</field>
            <field name="test_type">numeric</field>
            <field name="uom_id" ref="appointment_products.uom_gram_ap"/>
            <field name="sequence">90</field>
            <field name="min_value">0</field>
            <field name="is_required">False</field>
        </record>
        <record id="crit_ret_0_075mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المحتجز - 0.075 mm</field>
            <field name="code">RET_0_075MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">91</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = (RET_0_075MM_GM / ORIG_WT_GM * 100) if ORIG_WT_GM else 0</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_ret_0_075mm_gm'), ref('crit_coarse_orig_wt_gm')])]"/>
        </record>
        <record id="crit_cum_ret_0_075mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المحتجز التراكمي - 0.075 mm</field>
            <field name="code">CUM_RET_0_075MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">92</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = (CUM_RET_2_36MM_PCT or 0) + (RET_0_075MM_PCT or 0)</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_cum_ret_2_36mm_pct'), ref('crit_ret_0_075mm_pct')])]"/>
        </record>
        <record id="crit_pass_0_075mm_pct" model="lab.test.criterion">
            <field name="template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="name">% المار - 0.075 mm</field>
            <field name="code">PASS_0_075MM_PCT</field>
            <field name="test_type">computed</field>
            <field name="uom_id" ref="appointment_products.uom_percent_ap"/>
            <field name="sequence">93</field>
            <field name="min_value">0</field>
            <field name="max_value">100</field>
            <field name="is_input_field">False</field>
            <field name="is_computed_field">True</field>
            <field name="computation_formula">result = 100 - (RET_0_075MM_PCT or 0)</field>
            <field name="depends_on_criteria_ids" eval="[(6,0,[ref('crit_ret_0_075mm_pct')])]"/>
        </record>

        <!-- Flow Template: single-stage for this test -->
        <record id="coarse_sieve_flow_template" model="lab.test.flow.template">
            <field name="name">فحص الركام الخشن (بحص) تدرج فقط</field>
            <field name="description">مرحلة واحدة: تحليل منخلي للركام الخشن</field>
            <field name="allow_parallel_tests" eval="True"/>
        </record>
        <record id="coarse_sieve_flow_stage1" model="lab.test.flow.template.line">
            <field name="template_id" ref="coarse_sieve_flow_template"/>
            <field name="sequence">10</field>
            <field name="test_template_id" ref="template_coarse_aggregate_sieve"/>
            <field name="sample_qty">1</field>
        </record>

        <!-- Product: البحص linked to the flow/template -->
        <record id="product_coarse_aggregate" model="product.template">
            <field name="name">العينة - البحص</field>
            <field name="type">consu</field>
            <field name="is_sample_product">True</field>
            <field name="tracking">serial</field>
            <field name="sample_type_id" ref="aggregate_sample_type"/>
            <field name="test_flow_template_id" ref="coarse_sieve_flow_template"/>
            <field name="categ_id" ref="product.product_category_all"/>
        </record>

        <!-- Link TOTAL_RET_GM dependencies after all RET_* records exist -->
        <function model="lab.test.criterion" name="write">
            <value eval="[ref('crit_coarse_total_ret_gm')]"/>
            <value eval="{'depends_on_criteria_ids': [(6,0,[ref('crit_ret_75mm_gm'), ref('crit_ret_63mm_gm'), ref('crit_ret_37_5mm_gm'), ref('crit_ret_20mm_gm'), ref('crit_ret_14mm_gm'), ref('crit_ret_10mm_gm'), ref('crit_ret_5mm_gm'), ref('crit_ret_2_36mm_gm'), ref('crit_ret_0_075mm_gm')])]}"/>
        </function>

    </data>
</odoo>
