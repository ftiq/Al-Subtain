<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="lab_result_set_dynamic_form" model="ir.ui.view">
        <field name="name">lab.result.set.dynamic.form</field>
        <field name="model">lab.result.set</field>
        <field name="inherit_id" ref="appointment_products.lab_result_set_form_dynamic"/>
        <field name="arch" type="xml">
            <xpath expr="//form" position="attributes">
                <attribute name="archivable">true</attribute>
            </xpath>


            <xpath expr="//field[@name='result_line_ids']" position="replace">

                <div class="o_form_sheet">


                    <header>
                        <button name="action_retest"
                                type="object"
                                string="üîÑ ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÅÿ≠ÿµ"
                                class="btn btn-warning"
                                invisible="overall_result != 'fail' or state not in ['completed']"/>
                    </header>
                    
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="o_stat_info">
                                <span class="o_stat_value">

                                </span>
                                <span class="o_stat_text">ÿßŸÑŸÖÿπÿßŸäŸäÿ± ÿßŸÑŸÖŸÉÿ™ŸÖŸÑÿ©</span>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="o_stat_info">
                                <span class="o_stat_value">
                                    <field name="sample_count"/>
                                </span>
                                <span class="o_stat_text">ÿπÿØÿØ ÿßŸÑÿπŸäŸÜÿßÿ™</span>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="o_stat_info">
                                <span class="o_stat_value" 
                                       style="color: green;" 
                                       invisible="overall_conformity != 'pass'">‚úÖ</span>
                                <span class="o_stat_value" 
                                       style="color: red;" 
                                       invisible="overall_conformity != 'fail'">‚ùå</span>
                                <span class="o_stat_value" 
                                       style="color: orange;" 
                                       invisible="overall_conformity != 'pending'">‚è≥</span>
                                <span class="o_stat_text">ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿ∑ÿßÿ®ŸÇÿ©</span>
                            </div>
                        </div>
                    </div>


                    <field name="result_line_ids" 
                           mode="list,form" 
                           context="{'default_result_set_id': id}"
                           readonly="state in ['submitted','review','approved','completed','cancelled']">
                        <list editable="bottom" 
                              decoration-success="conformity_status == 'pass'"
                              decoration-danger="conformity_status == 'fail'"
                              decoration-muted="not result_value"
                              decoration-info="is_computed"
                              create="false" 
                              delete="false">
                            
                            <field name="sample_identifier" 
                                   string="ÿ±ŸÖÿ≤ ÿßŸÑÿπŸäŸÜÿ©" 
                                   readonly="1"
                                   optional="show"/>
                            
                            <field name="criterion_name" 
                                   string="ÿßŸÑŸÖÿπŸäÿßÿ±" 
                                   readonly="1"
                                   optional="show"/>
                            
                            <field name="data_type" invisible="1"
                                   optional="hide"/>
                            
                            <field name="result_value_numeric" 
                                   string="ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ±ŸÇŸÖŸäÿ©"
                                   invisible="data_type not in ['numeric','computed']"
                                   sum="ÿßŸÑŸÖÿ¨ŸÖŸàÿπ"
                                   avg="ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑"
                                   optional="show"/>
                            
                            
                            <field name="result_value_date" 
                                   string="ÿßŸÑÿ™ÿßÿ±ŸäÿÆ"
                                   invisible="data_type != 'date'"
                                   widget="date"
                                   optional="hide"/>
                            

                            <field name="unit_of_measure" 
                                   string="ÿßŸÑŸàÿ≠ÿØÿ©" 
                                   readonly="1"
                                   optional="show"/>
                            
                            <field name="reference_standard" 
                                   string="ÿßŸÑŸÖÿπŸäÿßÿ± ÿßŸÑŸÖÿ±ÿ¨ÿπŸä" 
                                   readonly="1"
                                   optional="hide"/>
                            
                            <field name="min_value" 
                                   string="ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ÿØŸÜŸâ" 
                                   readonly="1"
                                   optional="show"/>
                            
                            <field name="max_value" 
                                   string="ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ÿπŸÑŸâ" 
                                   readonly="1"
                                   optional="show"/>
                            
                            <field name="conformity_status" 
                                   string="ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿ∑ÿßÿ®ŸÇÿ©"
                                   readonly="1"
                                   widget="badge"
                                   decoration-success="conformity_status == 'pass'"
                                   decoration-danger="conformity_status == 'fail'"
                                   optional="show"/>
                            
                            <field name="notes" 
                                   string="ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™"
                                   optional="hide"/>
                                   
                            <field name="criterion_id" invisible="1" optional="hide"/>
                            <field name="result_set_id" invisible="1" optional="hide"/>
                            <field name="result_value" invisible="1" optional="hide"/>
                        </list>
                        
                        <form>
                            <sheet>
                                <div class="oe_title">
                                    <h1>
                                        <field name="sample_identifier" readonly="1"/>
                                        <span> - </span>
                                        <field name="criterion_name" readonly="1"/>
                                    </h1>
                                </div>
                                
                                <group>
                                    <group>
                                        <field name="data_type" invisible="1"/>
                                        <field name="criterion_id" invisible="1"/>
                                        <field name="result_set_id" invisible="1"/>
                                        
                                        <field name="result_value_numeric" 
                                               invisible="data_type not in ['numeric','computed']"
                                               required="data_type == 'numeric'"/>
                                        
                                        <field name="result_value_date" 
                                               invisible="data_type != 'date'"
                                               widget="date"/>
                                        
                                        <field name="unit_of_measure" readonly="1"/>
                                    </group>
                                    
                                    <group>
                                        <field name="reference_standard" readonly="1"/>
                                        <field name="min_value" readonly="1"/>
                                        <field name="max_value" readonly="1"/>
                                        <field name="conformity_status" readonly="1" widget="badge"/>
                                    </group>
                                </group>
                                
                                <group>
                                    <field name="notes" placeholder="ÿ£ÿ∂ŸÅ ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© ŸáŸÜÿß..."/>
                                </group>
                                
                                <div invisible="data_type != 'computed'">
                                    <h3>ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑÿ≠ÿ≥ÿßÿ®</h3>
                                    <div class="alert alert-info">
                                        <strong>ÿßŸÑŸÖÿπÿßÿØŸÑÿ©:</strong> 
                                        <code><field name="computation_formula" readonly="1"/></code>
                                    </div>
                                </div>
                            </sheet>
                        </form>
                    </field>
                </div>
            </xpath>
        </field>
    </record>

    <record id="lab_result_set_tree_enhanced" model="ir.ui.view">
        <field name="name">lab.result.set.tree.enhanced</field>
        <field name="model">lab.result.set</field>
        <field name="inherit_id" ref="appointment_products.lab_result_set_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='overall_result']" position="after">
                <field name="progress_percentage" widget="progressbar"/>
                <field name="sample_count"/>
                <field name="quality_check_id" optional="show"/>
            </xpath>
        </field>
    </record>

    <record id="lab_result_set_search_enhanced" model="ir.ui.view">
        <field name="name">lab.result.set.search.enhanced</field>
        <field name="model">lab.result.set</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="sample_id"/>
                <field name="template_id"/>
                <field name="quality_check_id"/>
                
                <filter name="state_draft" string="ŸÖÿ≥ŸàÿØÿ©" domain="[('state', '=', 'draft')]"/>
                <filter name="state_in_progress" string="ŸÇŸäÿØ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞" domain="[('state', '=', 'in_progress')]"/>
                <filter name="state_completed" string="ŸÖŸÉÿ™ŸÖŸÑ" domain="[('state', '=', 'completed')]"/>
                
                <separator/>
                <filter name="conformity_pass" string="ŸÖÿ∑ÿßÿ®ŸÇ" domain="[('overall_result', '=', 'pass')]"/>
                <filter name="conformity_fail" string="ÿ∫Ÿäÿ± ŸÖÿ∑ÿßÿ®ŸÇ" domain="[('overall_result', '=', 'fail')]"/>
                <filter name="conformity_pending" string="ŸÅŸä ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±" domain="[('overall_result', '=', 'pending')]"/>
                
                <separator/>
                <filter name="with_quality_check" string="ŸÖÿπ ŸÅÿ≠ÿµ ÿ¨ŸàÿØÿ©" domain="[('quality_check_id', '!=', False)]"/>
                <filter name="without_quality_check" string="ÿ®ÿØŸàŸÜ ŸÅÿ≠ÿµ ÿ¨ŸàÿØÿ©" domain="[('quality_check_id', '=', False)]"/>
                
                <group expand="0" string="ÿ™ÿ¨ŸÖŸäÿπ">
                    <filter name="group_by_state" string="ÿßŸÑÿ≠ÿßŸÑÿ©" context="{'group_by': 'state'}"/>
                    <filter name="group_by_conformity" string="ÿßŸÑŸÖÿ∑ÿßÿ®ŸÇÿ©" context="{'group_by': 'overall_result'}"/>
                    <filter name="group_by_template" string="ŸÇÿßŸÑÿ® ÿßŸÑŸÅÿ≠ÿµ" context="{'group_by': 'template_id'}"/>
                    <filter name="group_by_sample" string="ÿßŸÑÿπŸäŸÜÿ©" context="{'group_by': 'sample_id'}"/>
                </group>
            </search>
        </field>
    </record>

</odoo> 