<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="lab_result_set_tree" model="ir.ui.view">
        <field name="name">lab.result.set.tree</field>
        <field name="model">lab.result.set</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
                <field name="sample_id"/>
                <field name="concrete_field_code" string="ÿßŸÑÿ±ŸÖÿ≤ ÿßŸÑŸÖÿÆÿ™ÿ®ÿ±Ÿä"/>
                <field name="concrete_field_serial" string="ÿßŸÑÿ±ŸÖÿ≤ ÿßŸÑÿ≠ŸÇŸÑŸä"/>
                <field name="concrete_age_days" string="ÿßŸÑÿ£ŸäÿßŸÖ" widget="badge"/>
                <field name="template_id"/>
                <field name="state"/>
                <field name="overall_result" widget="badge" decoration-success="overall_result == 'pass'" decoration-danger="overall_result == 'fail'" decoration-muted="overall_result == 'pending'"/>
            </list>
        </field>
    </record>


    <record id="lab_result_set_form_dynamic" model="ir.ui.view">
        <field name="name">lab.result.set.form.dynamic</field>
        <field name="model">lab.result.set</field>
        <field name="arch" type="xml">
            <form string="üìä ÿ¨ÿØŸàŸÑ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨" create="false" edit="true" delete="false">
                <header>
                    <button name="action_start_timer" type="object" string="üïê ÿ®ÿØÿ° ÿßŸÑŸÖÿ§ŸÇÿ™" 
                            class="btn btn-primary" 
                            invisible="timer_start or state != 'in_progress' or not has_timer_criteria"
                            title="ÿ®ÿØÿ° ÿßŸÑŸÖÿ§ŸÇÿ™ ÿßŸÑÿπÿßŸÖ ŸÑŸÑŸÖÿ¨ŸÖŸàÿπÿ©"/>
                    <button name="action_start" type="object" string="ÿ®ÿØÿ° ÿßŸÑŸÅÿ≠ÿµ" 
                            invisible="state != 'draft'" 
                            class="btn btn-primary"/>
                    <button name="action_calculate_results" type="object" string="ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨" 
                            invisible="state not in ['in_progress'] or (has_timer_criteria and timer_status != 'completed')" 
                            class="btn btn-success"/>

                    <button name="action_show_test_details" type="object" string="üìä ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨" 
                            invisible="state in ['draft']" 
                            class="btn btn-info"
                            title="ÿπÿ±ÿ∂ ÿ™ŸÅÿßÿµŸäŸÑ ÿ¥ÿßŸÖŸÑÿ© ÿπŸÜ ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÅÿ≠ÿµ ŸàÿßŸÑŸÖÿπÿßŸäŸäÿ± ÿßŸÑÿ≠ÿ±ÿ¨ÿ©"/>

                    <button name="action_approve_results" type="object" string="ÿßÿπÿ™ŸÖÿßÿØ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨" 
                            invisible="state not in ['calculated', 'review']" 
                            class="btn btn-success"/>
                    <button name="action_print_report" type="object" string="ÿ∑ÿ®ÿßÿπÿ© ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±" 
                            invisible="state not in ['approved', 'completed']" 
                            class="btn btn-info"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,in_progress,calculated,approved"/>
                </header>
                <sheet>

                    <div class="oe_title" invisible="1"/>
                    

                    <div class="alert alert-info" invisible="not has_timer_criteria or all_timers_completed">
                        <div class="row">
                            <div class="col-md-12">
                                <i class="fa fa-info-circle"/> 
                                <strong></strong> Ÿäÿ≠ÿ™ŸàŸä Ÿáÿ∞ÿß ÿßŸÑŸÇÿßŸÑÿ® ÿπŸÑŸâ ŸÖÿπÿßŸäŸäÿ± ŸÖÿ±ÿ™ÿ®ÿ∑ÿ© ÿ®ÿßŸÑŸÖÿ§ŸÇÿ™. 
                                Ÿäÿ¨ÿ® ÿ®ÿØÿ° ÿßŸÑŸÅÿ≠ÿµ ÿ£ŸàŸÑÿßŸã ÿ´ŸÖ ÿßÿØÿÆÿßŸÑ ÿßŸÑŸÇŸäŸÖ ÿ∫Ÿäÿ± ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ∑ÿ© ÿ®ÿßŸÑŸÖÿ§ŸÇÿ™ ÿ´ŸÖ ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿ®ÿØÿ° ÿßŸÑŸÖÿ§ŸÇÿ™.
                            </div>
                        </div>
                    </div>
                    

                    <div class="alert alert-info" invisible="not timer_start or not has_timer_criteria">
                        <div class="row">
                            <div class="col-md-3">
                                <strong>ÿ®ÿØÿßŸäÿ© ÿßŸÑŸÖÿ§ŸÇŸëÿ™:</strong><br/>
                                <field name="timer_start" readonly="1"/>
                            </div>
                            <div class="col-md-3">
                                <strong>ŸÜŸáÿßŸäÿ© ÿßŸÑŸÖÿ§ŸÇŸëÿ™:</strong><br/>
                                <field name="timer_ready" readonly="1"/>
                            </div>
                            <div class="col-md-3">
                                <strong>ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿ§ŸÇŸëÿ™:</strong><br/>
                                <field name="timer_status" readonly="1" widget="badge"/>
                            </div>
                            <div class="col-md-3">
                                <strong>ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä:</strong><br/>
                                <field name="timer_remaining" widget="lab_timer" readonly="1"/>
                            </div>
                        </div>
                    </div>
                    

                    <div class="alert alert-warning" invisible="timer_status != 'running' or not has_timer_criteria">
                        <i class="fa fa-exclamation-triangle"/> 
                        <strong>ÿ™ÿ≠ÿ∞Ÿäÿ±:</strong> ÿßŸÑŸÖÿ§ŸÇÿ™ ŸÜÿ¥ÿ∑ - ŸÑÿß ŸäŸÖŸÉŸÜ ÿ•ÿØÿÆÿßŸÑ ÿ£Ÿà ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÇŸäŸÖ ÿ≠ÿ™Ÿâ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑŸÖÿ§ŸÇÿ™
                    </div>
                    
                    <div class="alert alert-success" invisible="timer_status != 'completed' or not has_timer_criteria">
                        <i class="fa fa-check-circle"/> 
                        <strong>ÿ™ŸÖ:</strong> ÿßŸÜÿ™ŸáŸâ ÿßŸÑŸÖÿ§ŸÇÿ™ - ŸäŸÖŸÉŸÜ ÿßŸÑÿ¢ŸÜ ÿ•ÿØÿÆÿßŸÑ Ÿàÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÇŸäŸÖ
                    </div>
                    
                    <group>
                        <group string="ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ£ÿ≥ÿßÿ≥Ÿäÿ©">
                            <field name="name" readonly="1"/>
                            <field name="sample_id" readonly="1"/>
                            <field name="template_id" readonly="1"/>
                        </group>
                        <group string="ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ŸàÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™">
                            <field name="overall_result" widget="badge" readonly="1"/>
                            <field name="overall_conformity" widget="badge" readonly="1"/>
                            <field name="is_manager" invisible="1"/>
                            <field name="testers_ids" widget="many2many_tags" 
                                   groups="appointment_products.group_lab_manager"
                                   string="ÿßŸÑŸÖŸÉŸÑŸÅŸàŸÜ ÿ®ÿßŸÑŸÅÿ≠ÿµ"
                                   help="Ÿáÿ∞ÿß ÿßŸÑÿ≠ŸÇŸÑ Ÿäÿ≠ÿØÿØ ŸÖŸÜ Ÿäÿ≥ÿ™ÿ∑Ÿäÿπ ÿßŸÑŸàÿµŸàŸÑ Ÿàÿ™ÿπÿØŸäŸÑ Ÿáÿ∞ÿß ÿßŸÑŸÅÿ≠ÿµ. ÿßŸÑŸÅŸÜŸäŸàŸÜ Ÿäÿ±ŸàŸÜ ŸÅŸÇÿ∑ ÿßŸÑŸÅÿ≠Ÿàÿµÿßÿ™ ÿßŸÑŸÖŸÉŸÑŸÅŸäŸÜ ÿ®Ÿáÿß ŸáŸÜÿß."/>
                            <field name="has_timer_criteria" invisible="1"/>
                            <field name="all_timers_completed" invisible="1"/>
                        </group>
                    </group>
                    

                    <notebook>
                        <page string="üìä ÿ¨ÿØŸàŸÑ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨">
                            <field name="result_line_ids" widget="dynamic_results_table" readonly="state != 'in_progress'" options="{'pager': true}">
                                <list editable="bottom" decoration-bf="is_critical" class="o_dynamic_results_table" limit="10" options="{'pager': true}" open_form_view="false">
                                    <control>
                                        <create string="‚ûï ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿπŸäÿßÿ± ÿ¨ÿØŸäÿØ"/>
                                    </control>
                                    

                                    <field name="sequence" widget="handle"/>
                                    <field name="criterion_id" 
                                           options="{'no_create': False, 'no_edit': False}"
                                           class="o_required_field"/>
                                    <field name="criterion_code" readonly="1"/>
                                    <field name="test_type" readonly="1"/>
                                    

                                    <field name="timer_scope" invisible="1"/>
                                    <field name="waiting_unit" invisible="1"/>
                                    <field name="waiting_value" invisible="1"/>
                                    <field name="lock_during_wait" invisible="1"/>
                                    <field name="is_timer_done" invisible="1"/>
                                    <field name="line_timer_start" invisible="1"/>
                                    <field name="line_timer_ready" invisible="1"/>
                                    

                                    <field name="value_numeric" 
                                           string="ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ±ŸÇŸÖŸäÿ©"
                                           readonly="lock_during_wait and not is_timer_done"
                                           class="o_field_numeric"
                                           decoration-muted="lock_during_wait and not is_timer_done"
                                           decoration-info="waiting_value and lock_during_wait and not is_timer_done"
                                           help="ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ±ŸÇŸÖŸäÿ© ŸÑŸÑŸÖÿπŸäÿßÿ±"/>
                                    <field name="value_text" 
                                           string="ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑŸÜÿµŸäÿ©"
                                           readonly="lock_during_wait and not is_timer_done"
                                           decoration-muted="lock_during_wait and not is_timer_done"
                                           decoration-info="waiting_value and lock_during_wait and not is_timer_done"
                                           invisible="test_type != 'text'"/>
                                    <field name="value_selection" 
                                           string="ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±"
                                           readonly="lock_during_wait and not is_timer_done"
                                           decoration-muted="lock_during_wait and not is_timer_done"
                                           decoration-info="waiting_value and lock_during_wait and not is_timer_done"
                                           invisible="test_type != 'selection'"/>
                                    <field name="value_boolean" 
                                           string="ÿµÿ≠/ÿÆÿ∑ÿ£"
                                           readonly="lock_during_wait and not is_timer_done"
                                           decoration-muted="lock_during_wait and not is_timer_done"
                                           decoration-info="waiting_value and lock_during_wait and not is_timer_done"
                                           invisible="test_type != 'boolean'"/>
                                    <field name="value_date" 
                                           string="ÿßŸÑÿ™ÿßÿ±ŸäÿÆ"
                                           readonly="lock_during_wait and not is_timer_done"
                                           decoration-muted="lock_during_wait and not is_timer_done"
                                           decoration-info="waiting_value and lock_during_wait and not is_timer_done"
                                           invisible="test_type != 'date'"/>
                                    <field name="value_computed" 
                                           column_invisible="test_type != 'computed'"
                                           string="ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨"
                                           readonly="1"
                                           style="background-color: #e8f0ff;"/>
                                    <field name="min_limit" readonly="1"/>
                                    <field name="max_limit" readonly="1"/>
                                    <field name="target_value" readonly="1"/>
                                    <field name="uom_id" readonly="1"/>
                                    

                                    <field name="is_compliant" 
                                           widget="boolean_toggle"
                                           decoration-success="is_compliant == True"
                                           decoration-danger="is_compliant == False"/>
                                    <field name="deviation_percentage" 
                                           widget="percentage"
                                           decoration-warning="deviation_percentage > 5"
                                           decoration-danger="deviation_percentage > 10"/>
                                    <field name="conformity_status" 
                                           widget="badge"
                                           decoration-success="conformity_status == 'pass'"
                                           decoration-danger="conformity_status == 'fail'"/>
                                    

                                    <field name="is_critical" readonly="1"/>
                                    <field name="technician_id" readonly="1"/>
                                    <field name="last_modified_date" readonly="1"/>
                                    

                                    <button name="action_start_line_timer" type="object" string="‚è±Ô∏è" 
                                            class="btn btn-sm btn-secondary" 
                                            invisible="timer_scope != 'per_line' or line_timer_start or not waiting_value"
                                            title="ÿ®ÿØÿ° ŸÖÿ§ŸÇÿ™ ÿßŸÑÿ≥ÿ∑ÿ±"/>
                                    <field name="line_timer_ready" widget="lab_timer" 
                                           invisible="timer_scope != 'per_line' or not line_timer_start or not waiting_value" 
                                           readonly="1"/>
                                    
                                    <field name="notes"/>
                                </list>
                            </field>
                        </page>                        
                        <page string="üìã ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÅÿ≠ÿµ">
                            <group>
                                <group string="ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÅÿ≠ÿµ">
                                    <field name="test_conditions"/>
                                    <field name="environmental_conditions"/>
                                    <field name="equipment_used"/>
                                </group>
                                <group string="ÿ∂ŸÖÿßŸÜ ÿßŸÑÿ¨ŸàÿØÿ©">
                                    <field name="calibration_date"/>
                                    <field name="reference_standard"/>
                                    <field name="uncertainty_analysis"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                
                <chatter/>
            </form>
        </field>
    </record>

    <record id="lab_result_set_search" model="ir.ui.view">
        <field name="name">lab.result.set.search</field>
        <field name="model">lab.result.set</field>
        <field name="arch" type="xml">
            <search string="ÿßŸÑÿ®ÿ≠ÿ´ ŸÅŸä ŸÖÿ¨ŸÖŸàÿπÿßÿ™ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨">
                <field name="name" string="ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ©"/>
                <field name="sample_id" string="ÿßŸÑÿπŸäŸÜÿ©"/>
                <field name="template_id" string="ŸÇÿßŸÑÿ® ÿßŸÑŸÅÿ≠ÿµ"/>
                <field name="technician_id" string="ÿßŸÑŸÅŸÜŸä"/>
                <field name="concrete_field_code" string="ÿßŸÑÿ±ŸÖÿ≤ ÿßŸÑŸÖÿÆÿ™ÿ®ÿ±Ÿä"/>
                <field name="concrete_field_serial" string="ÿßŸÑÿ±ŸÖÿ≤ ÿßŸÑÿ≠ŸÇŸÑŸä"/>
                <field name="concrete_age_days" string="ÿ£ŸäÿßŸÖ ÿßŸÑÿÆÿ±ÿ≥ÿßŸÜÿ©"/>
                
                <filter name="state_draft" string="ŸÖÿ≥ŸàÿØÿ©" domain="[('state', '=', 'draft')]"/>
                <filter name="state_in_progress" string="ŸÇŸäÿØ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞" domain="[('state', '=', 'in_progress')]"/>
                <filter name="state_calculated" string="ŸÖÿ≠ÿ≥Ÿàÿ®ÿ©" domain="[('state', '=', 'calculated')]"/>
                <filter name="state_approved" string="ŸÖÿπÿ™ŸÖÿØÿ©" domain="[('state', '=', 'approved')]"/>
                
                <separator/>
                <filter name="assigned_to_me" string="ÿßŸÑŸÖŸÉŸÑŸÅ ÿ®Ÿä" domain="[('testers_ids', 'in', [uid])]"/>
                
                <separator/>
                <filter name="result_pass" string="ŸÜÿ¨ÿ≠" domain="[('overall_result', '=', 'pass')]"/>
                <filter name="result_fail" string="ŸÅÿ¥ŸÑ" domain="[('overall_result', '=', 'fail')]"/>
                
                <separator/>
                <filter name="conformity_pass" string="ŸÖÿ∑ÿßÿ®ŸÇ" domain="[('overall_conformity', '=', 'pass')]"/>
                <filter name="conformity_fail" string="ÿ∫Ÿäÿ± ŸÖÿ∑ÿßÿ®ŸÇ" domain="[('overall_conformity', '=', 'fail')]"/>
                
                <separator/>
                <filter name="has_timer" string="Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ŸÖÿ§ŸÇÿ™" domain="[('has_timer_criteria', '=', True)]"/>
                <filter name="no_timer" string="ÿ®ÿØŸàŸÜ ŸÖÿ§ŸÇÿ™" domain="[('has_timer_criteria', '=', False)]"/>
                <filter name="timers_completed" string="ÿßŸÑŸÖÿ§ŸÇÿ™ÿßÿ™ ŸÖŸÉÿ™ŸÖŸÑÿ©" domain="[('all_timers_completed', '=', True)]"/>
                
                <group expand="0" string="ÿ™ÿ¨ŸÖŸäÿπ ÿ≠ÿ≥ÿ®">
                    <filter name="group_sample" string="ÿßŸÑÿπŸäŸÜÿ©" context="{'group_by': 'sample_id'}"/>
                    <filter name="group_template" string="ŸÇÿßŸÑÿ® ÿßŸÑŸÅÿ≠ÿµ" context="{'group_by': 'template_id'}"/>
                    <filter name="group_state" string="ÿßŸÑÿ≠ÿßŸÑÿ©" context="{'group_by': 'state'}"/>
                    <filter name="group_result" string="ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©" context="{'group_by': 'overall_result'}"/>
                    <filter name="group_technician" string="ÿßŸÑŸÅŸÜŸä" context="{'group_by': 'technician_id'}"/>
                    <filter name="group_timer" string="ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿ§ŸÇÿ™" context="{'group_by': 'has_timer_criteria'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="view_lab_result_set_kanban" model="ir.ui.view">
        <field name="name">lab.result.set.kanban</field>
        <field name="model">lab.result.set</field>
        <field name="arch" type="xml">
            <kanban default_group_by="state" 
                    class="o_kanban_small_column o_lab_result_set_kanban o_kanban_dashboard"
                    sample="1" quick_create="false" archivable="false" delete="false" create="false"
                    records_draggable="false" groups_draggable="false">
                <field name="id"/>
                <field name="name"/>
                <field name="sample_id"/>
                <field name="template_id"/>
                <field name="state"/>
                <field name="overall_result"/>
                <field name="overall_conformity"/>
                <field name="progress_percentage"/>
                <field name="technician_id"/>
                <field name="total_criteria_count"/>
                <field name="failed_criteria_count"/>
                <field name="create_date"/>
                <field name="write_date"/>
                <field name="has_timer_criteria"/>
                <field name="timer_start"/>
                <field name="timer_ready"/>
                <field name="timer_status"/>
                <field name="timer_remaining"/>
                <field name="timer_remaining_display"/>
                <field name="is_concrete_sample"/>
                <field name="concrete_group_no"/>
                <field name="concrete_age_days"/>
                <field name="concrete_field_code"/>
                <field name="concrete_field_serial"/>

                <progressbar field="overall_result" 
                           colors='{"pass": "success", "fail": "danger", "pending": "warning"}'
                           help="ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÇÿØŸÖ Ÿäÿ∏Ÿáÿ± ÿ≠ÿßŸÑÿ© ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÅÿ≠Ÿàÿµÿßÿ™"/>

                <templates>
                    <t t-name="kanban-menu">
                        <a role="menuitem" type="open" class="dropdown-item">
                            <i class="fa fa-pencil me-2"/> ŸÅÿ™ÿ≠ ŸÑŸÑÿ™ÿ≠ÿ±Ÿäÿ±
                        </a>
                        <a role="menuitem" type="edit" class="dropdown-item">
                            <i class="fa fa-edit me-2"/> ÿ™ÿ≠ÿ±Ÿäÿ± ÿ≥ÿ±Ÿäÿπ
                        </a>
                        <div class="dropdown-divider"/>
                        <a role="menuitem" type="delete" class="dropdown-item">
                            <i class="fa fa-trash me-2"/> ÿ≠ÿ∞ŸÅ
                        </a>
                    </t>

                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click o_lab_result_set_card"
                             t-attf-class="#{record.state.raw_value == 'in_progress' ? 'o_kanban_card_pulse' : ''} 
                                          #{record.overall_result.raw_value == 'fail' ? 'border-danger' : record.overall_result.raw_value == 'pass' ? 'border-success' : 'border-warning'}">
                            

                            <div class="o_kanban_card_header">
                                <div class="o_kanban_card_header_title">
                                    <div class="o_kanban_record_top">
                                        <div class="o_kanban_top_left">
                                            <strong class="o_kanban_record_title">
                                                <i class="fa fa-flask me-2 text-primary"/>
                                                <field name="name"/>
                                            </strong>
                                            <div class="o_kanban_record_subtitle text-muted">
                                                <i class="fa fa-cube me-1"/>
                                                <field name="sample_id"/>
                                            </div>
                                            

                                            <div class="o_kanban_record_subtitle text-muted" 
                                                 t-if="record.is_concrete_sample.raw_value">
                                                <div class="d-flex flex-wrap gap-1 mt-1">

                                                    <span class="badge bg-info text-dark" 
                                                          t-if="record.concrete_group_no.raw_value">
                                                        <i class="fa fa-users me-1"/>
                                                        ŸÖÿ¨ŸÖŸàÿπÿ© <t t-esc="record.concrete_group_no.raw_value"/>
                                                    </span>
                                                    

                                                    <span class="badge bg-secondary" 
                                                          t-if="record.concrete_age_days.raw_value">
                                                        <i class="fa fa-calendar me-1"/>
                                                        <t t-if="record.concrete_age_days.raw_value == '7'">7 ÿ£ŸäÿßŸÖ</t>
                                                        <t t-elif="record.concrete_age_days.raw_value == '28'">28 ŸäŸàŸÖ</t>
                                                        <t t-else="">ÿßÿ≠ÿ™Ÿäÿßÿ∑</t>
                                                    </span>
                                                    

                                                    <span class="badge bg-primary" 
                                                          t-if="record.concrete_field_code.raw_value">
                                                        <i class="fa fa-flask me-1"/>
                                                        <t t-esc="record.concrete_field_code.raw_value"/>
                                                    </span>
                                                    

                                                    <span class="badge bg-success" 
                                                          t-if="record.concrete_field_serial.raw_value">
                                                        <i class="fa fa-map-marker me-1"/>
                                                        <t t-esc="record.concrete_field_serial.raw_value"/>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="o_kanban_top_right">
                                            <div class="o_dropdown_kanban dropdown">
                                                <a role="button" class="dropdown-toggle o-no-caret btn" data-bs-toggle="dropdown" 
                                                   href="#" aria-label="Dropdown menu" title="ÿßŸÑŸÇÿßÿ¶ŸÖÿ©">
                                                    <span class="fa fa-ellipsis-v"/>
                                                </a>
                                                <div class="dropdown-menu" role="menu">
                                                    <t t-call="kanban-menu"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            

                            <div class="o_kanban_card_content">

                                <div class="o_kanban_tags_section mb-2">
                                    <div class="o_kanban_tag_row" t-if="record.template_id.raw_value">
                                        <span class="o_kanban_tag o_kanban_tag_template">
                                            <i class="fa fa-list-alt me-1"/>
                                            <field name="template_id"/>
                                        </span>
                                    </div>
                                </div>
                                

                                <div class="o_kanban_progress_section mb-3" t-if="record.progress_percentage.raw_value">
                                    <div class="o_kanban_progress_header d-flex justify-content-between align-items-center">
                                        <span class="o_kanban_progress_label">
                                            <i class="fa fa-tasks me-1"/>
                                            ÿßŸÑÿ™ŸÇÿØŸÖ
                                        </span>
                                        <span class="o_kanban_progress_value">
                                            <field name="progress_percentage" widget="percentage"/>
                                        </span>
                                    </div>
                                    <div class="progress mt-1" style="height: 8px;">
                                        <div class="progress-bar" 
                                             t-attf-class="#{record.progress_percentage.raw_value >= 1.0 ? 'bg-success' : record.progress_percentage.raw_value >= 0.5 ? 'bg-warning' : 'bg-info'}"
                                             role="progressbar" 
                                             t-attf-style="width: #{record.progress_percentage.raw_value * 100}%"
                                             t-attf-aria-valuenow="#{record.progress_percentage.raw_value * 100}"
                                             aria-valuemin="0" aria-valuemax="100">
                                        </div>
                                    </div>
                                </div>
                                

                                <div class="o_kanban_timer_section mb-2" t-if="record.has_timer_criteria.raw_value and record.timer_start.raw_value">
                                    <div class="alert alert-info border-info p-2 mb-2" t-if="record.timer_status.raw_value == 'running'">
                                        <div class="d-flex align-items-center">
                                            <i class="fa fa-clock-o me-2 text-info"/>
                                            <div class="flex-grow-1">
                                                <small class="d-block text-muted">üïê ÿßŸÑŸÖÿ§ŸÇÿ™ ŸäÿπŸÖŸÑ</small>
                                                <strong class="text-info" t-if="record.timer_remaining_display.raw_value">
                                                    <t t-esc="record.timer_remaining_display.raw_value"/>
                                                </strong>
                                                <small class="d-block text-muted">ŸÖÿ™ÿ®ŸÇŸä</small>
                                            </div>
                                            <span class="badge bg-warning text-dark">
                                                <i class="fa fa-hourglass-half"/>
                                                ŸäÿπŸÖŸÑ
                                            </span>
                                        </div>
                                    </div>
                                    <div class="alert alert-success border-success p-2 mb-2" t-if="record.timer_status.raw_value == 'completed'">
                                        <div class="d-flex align-items-center">
                                            <i class="fa fa-check-circle me-2 text-success"/>
                                            <div class="flex-grow-1">
                                                <small class="d-block text-muted">‚úÖ ÿßŸÑŸÖÿ§ŸÇÿ™ ÿßŸÜÿ™ŸáŸâ</small>
                                                <small class="text-success">ŸäŸÖŸÉŸÜ ÿ•ÿØÿÆÿßŸÑ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨</small>
                                            </div>
                                            <span class="badge bg-success">
                                                <i class="fa fa-check"/>
                                                ÿßŸÜÿ™ŸáŸâ
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                

                                <div class="o_kanban_results_section mb-2" t-if="record.overall_result.raw_value != 'pending'">
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <div class="text-center">
                                                <small class="text-muted d-block">ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©</small>
                                                <field name="overall_result" widget="badge"
                                                       decoration-success="overall_result == 'pass'"
                                                       decoration-danger="overall_result == 'fail'"
                                                       decoration-warning="overall_result == 'pending'"/>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="text-center">
                                                <small class="text-muted d-block">ÿßŸÑŸÖÿ∑ÿßÿ®ŸÇÿ©</small>
                                                <field name="overall_conformity" widget="badge"
                                                       decoration-success="overall_conformity == 'pass'"
                                                       decoration-danger="overall_conformity == 'fail'"
                                                       decoration-warning="overall_conformity == 'pending'"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                

                                <div class="o_kanban_stats_section">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="o_kanban_stats_left">
                                            <span class="badge bg-primary me-1" t-if="record.total_criteria_count.raw_value">
                                                <i class="fa fa-list me-1"/>
                                                <t t-esc="record.total_criteria_count.raw_value"/> ŸÖÿπŸäÿßÿ±
                                            </span>
                                            <span class="badge bg-danger" t-if="record.failed_criteria_count.raw_value">
                                                <i class="fa fa-times-circle me-1"/>
                                                <t t-esc="record.failed_criteria_count.raw_value"/> ŸÅÿ¥ŸÑ
                                            </span>
                                        </div>
                                        <div class="o_kanban_stats_right">
                                            <field name="technician_id" widget="many2one_avatar_user" 
                                                   class="oe_kanban_avatar" domain="[('share', '=', False)]"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            

                            <div class="o_kanban_card_footer">
                                <div class="o_kanban_footer_left">
                                    <small class="text-muted">
                                        <i class="fa fa-calendar me-1"/>
                                        <field name="write_date" widget="relative"/>
                                    </small>
                                </div>
                                <div class="o_kanban_footer_right">
                                    <div class="o_kanban_status_indicator">
                                        <t t-if="record.state.raw_value == 'draft'">
                                            <i class="fa fa-circle text-secondary" title="ŸÖÿ≥ŸàÿØÿ©"/>
                                        </t>
                                        <t t-if="record.state.raw_value == 'in_progress'">
                                            <i class="fa fa-circle text-warning" title="ŸÇŸäÿØ ÿßŸÑÿ™ŸÇÿØŸÖ"/>
                                        </t>
                                        <t t-if="record.state.raw_value == 'review'">
                                            <i class="fa fa-circle text-info" title="ŸÇŸäÿØ ÿßŸÑŸÖÿ±ÿßÿ¨ÿπÿ©"/>
                                        </t>
                                        <t t-if="record.state.raw_value == 'approved'">
                                            <i class="fa fa-circle text-success" title="ŸÖÿπÿ™ŸÖÿØ"/>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="action_lab_result_sets" model="ir.actions.act_window">
        <field name="name">üìä ŸÖÿ¨ŸÖŸàÿπÿßÿ™ ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÖÿÆÿ™ÿ®ÿ±</field>
        <field name="res_model">lab.result.set</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="view_ids" eval="[(5, 0, 0),
            (0, 0, {'view_mode': 'kanban', 'view_id': ref('view_lab_result_set_kanban')}),
            (0, 0, {'view_mode': 'list', 'view_id': ref('lab_result_set_tree')}),
            (0, 0, {'view_mode': 'form', 'view_id': ref('lab_result_set_form_dynamic')})]"/>
        <field name="groups_id" eval="[(4, ref('appointment_products.group_lab_technician')), (4, ref('appointment_products.group_lab_manager'))]"/>
    </record>

    <record id="action_lab_result_set_dynamic" model="ir.actions.act_window">
        <field name="name">üìä ÿ¨ÿØŸàŸÑ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨</field>
        <field name="res_model">lab.result.set</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="view_ids" eval="[(5, 0, 0),
            (0, 0, {'view_mode': 'kanban', 'view_id': ref('view_lab_result_set_kanban')}),
            (0, 0, {'view_mode': 'list', 'view_id': ref('lab_result_set_tree')}),
            (0, 0, {'view_mode': 'form', 'view_id': ref('lab_result_set_form_dynamic')})]"/>
        <field name="search_view_id" ref="lab_result_set_search"/>
        <field name="target">current</field>
        <field name="context">{
            'search_default_state_in_progress': 1,
            'create': false
        }</field>
        <field name="groups_id" eval="[(4, ref('appointment_products.group_lab_technician')), (4, ref('appointment_products.group_lab_manager'))]"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                ÿπÿ±ÿ∂ ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÅÿ≠Ÿàÿµÿßÿ™
            </p>
        </field>
    </record>


    <record id="view_lab_result_line_kanban" model="ir.ui.view">
        <field name="name">lab.result.line.kanban</field>
        <field name="model">lab.result.line</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_small_column o_lab_result_line_kanban" archivable="false" delete="false" records_draggable="false" groups_draggable="false" default_group_by="criterion_id">
                <field name="id"/>
                <field name="criterion_id"/>
                <field name="sample_no"/>
                <field name="result_value"/>
                <field name="is_compliant"/>
                <field name="is_critical"/>
                <field name="technician_id"/>
                <field name="last_modified_date"/>
                <field name="conformity_status"/>

                <templates>
                    <t t-name="card">
                        <div class="o_kanban_record_top">
                            <strong class="o_kanban_record_title">
                                <t t-if="record.sample_no.raw_value">ÿπŸäŸÜÿ© <t t-esc="record.sample_no.raw_value"/> ‚Äì </t>
                                <field name="criterion_id"/>
                            </strong>
                        </div>
                        <div class="o_kanban_record_body p-2">
                            <div class="row">
                                <div class="col-12">
                                    <span class="fw-bold">ÿßŸÑŸÇŸäŸÖÿ©:</span>
                                    <t t-esc="record.result_value.raw_value or '-'"/>
                                </div>
                            </div>
                            <div class="row mt-1">
                                <div class="col-6">
                                    <field name="conformity_status" widget="badge" decoration-success="conformity_status == 'pass'" decoration-danger="conformity_status == 'fail'"/>
                                </div>
                                <div class="col-6" t-if="record.is_critical.raw_value">
                                    <span class="badge bg-danger">ÿ≠ÿ±ÿ¨</span>
                                </div>
                            </div>
                            <div class="row mt-1" t-if="record.last_modified_date.raw_value">
                                <div class="col-12">
                                    <small class="text-muted">
                                        <i class="fa fa-clock-o me-1"/>
                                        <field name="last_modified_date" widget="datetime"/>
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="o_kanban_record_bottom">
                            <div class="oe_kanban_bottom_left">
                                <t t-if="record.is_compliant.raw_value == True">
                                    <i class="fa fa-check-circle text-success" title="ŸÖÿ∑ÿßÿ®ŸÇ"/>
                                </t>
                                <t t-if="record.is_compliant.raw_value == False">
                                    <i class="fa fa-times-circle text-danger" title="ÿ∫Ÿäÿ± ŸÖÿ∑ÿßÿ®ŸÇ"/>
                                </t>
                            </div>
                            <div class="oe_kanban_bottom_right">
                                <field name="technician_id" widget="many2one_avatar_user" class="oe_kanban_avatar" domain="[('share', '=', False)]"/>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>


    <record id="action_lab_result_lines_kanban" model="ir.actions.act_window">
        <field name="name">üìã ÿ£ÿ≥ÿ∑ÿ± ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ (Kanban)</field>
        <field name="res_model">lab.result.line</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="view_ids" eval="[(5,0,0),
            (0,0,{'view_mode':'kanban','view_id':ref('view_lab_result_line_kanban')})]"/>
        <field name="target">current</field>
        <field name="groups_id" eval="[(4, ref('appointment_products.group_lab_technician')), (4, ref('appointment_products.group_lab_manager'))]"/>
    </record>
</odoo> 