<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data noupdate="1">

    <!-- Documents: Viewer (read-only in company and department scope) -->
    <record id="rule_v2_document_viewer_read" model="ir.rule">
      <field name="name">V2: عارض - قراءة وثائق ضمن الشركة والقسم</field>
      <field name="model_id" ref="mgt_documents.model_document_document"/>
      <field name="domain_force">[
        '&amp;',
        ('company_id', 'in', user.company_ids.ids),
        '&amp;',
        ('confidentiality_level', '!=', 'top_secret'),
        '|','|','|',
          ('create_uid', '=', user.id),
          ('recipient_employee_id.user_id', '=', user.id),
          ('department_id', 'child_of', user.employee_id.department_id.id if user.employee_id and user.employee_id.department_id else False),
          ('sender_employee_id.department_id', 'child_of', user.employee_id.department_id.id if user.employee_id and user.employee_id.department_id else False)
      ]</field>
      <field name="groups" eval="[(4, ref('mgt_documents.group_doc_viewer'))]"/>
      <field name="perm_read" eval="True"/>
      <field name="perm_write" eval="False"/>
      <field name="perm_create" eval="False"/>
      <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Documents: Contributor (create/write own and department drafts) -->
    <record id="rule_v2_document_contributor_write" model="ir.rule">
      <field name="name">V2: مساهم - إنشاء/تعديل ضمن نطاق القسم</field>
      <field name="model_id" ref="mgt_documents.model_document_document"/>
      <field name="domain_force">[
        '&amp;',
        ('company_id', 'in', user.company_ids.ids),
        '&amp;', ('confidentiality_level', '!=', 'top_secret'),
        '|','|',
          ('create_uid', '=', user.id),
          '&amp;', ('department_id', 'child_of', user.employee_id.department_id.id if user.employee_id and user.employee_id.department_id else False), ('processing_state', 'in', ['received','registered']),
          '&amp;', ('sender_employee_id.department_id', 'child_of', user.employee_id.department_id.id if user.employee_id and user.employee_id.department_id else False), ('processing_state', 'in', ['received','registered'])
      ]</field>
      <field name="groups" eval="[(4, ref('mgt_documents.group_doc_contributor'))]"/>
      <field name="perm_read" eval="True"/>
      <field name="perm_write" eval="True"/>
      <field name="perm_create" eval="True"/>
      <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Documents: Manager (full department tree, exclude top_secret outside own doc unless needed) -->
    <record id="rule_v2_document_manager_full" model="ir.rule">
      <field name="name">V2: مدير - إدارة وثائق القسم والفروع</field>
      <field name="model_id" ref="mgt_documents.model_document_document"/>
      <field name="domain_force">[
        '&amp;',
        ('company_id', 'in', user.company_ids.ids),
        '&amp;', ('confidentiality_level', '!=', 'top_secret'),
        '|','|',
          ('department_id', 'child_of', user.employee_id.department_id.id if user.employee_id and user.employee_id.department_id else False),
          ('sender_employee_id.department_id', 'child_of', user.employee_id.department_id.id if user.employee_id and user.employee_id.department_id else False),
          ('create_uid', '=', user.id)
      ]</field>
      <field name="groups" eval="[(4, ref('mgt_documents.group_doc_manager')), (4, ref('mgt_documents.group_doc_records'))]"/>
      <field name="perm_read" eval="True"/>
      <field name="perm_write" eval="True"/>
      <field name="perm_create" eval="True"/>
      <field name="perm_unlink" eval="True"/>
    </record>

    <!-- Documents: Approver (can read docs they are approvers for) -->
    <record id="rule_v2_document_approver_read" model="ir.rule">
      <field name="name">V2: موافق - قراءة الوثائق المرتبطة بطلبات موافقته</field>
      <field name="model_id" ref="mgt_documents.model_document_document"/>
      <field name="domain_force">[
        ('approval_requests.approver_ids.user_id', '=', user.id)
      ]</field>
      <field name="groups" eval="[(4, ref('mgt_documents.group_doc_approver'))]"/>
      <field name="perm_read" eval="True"/>
      <field name="perm_write" eval="False"/>
      <field name="perm_create" eval="False"/>
      <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Documents: Records/Archivist (read/write for archival operations) -->
    <record id="rule_v2_document_records" model="ir.rule">
      <field name="name">V2: السجلات - إدارة الحفظ والأرشفة</field>
      <field name="model_id" ref="mgt_documents.model_document_document"/>
      <field name="domain_force">[
        '&amp;', ('company_id', 'in', user.company_ids.ids),
        ('confidentiality_level', '!=', 'top_secret')
      ]</field>
      <field name="groups" eval="[(4, ref('mgt_documents.group_doc_records'))]"/>
      <field name="perm_read" eval="True"/>
      <field name="perm_write" eval="True"/>
      <field name="perm_create" eval="False"/>
      <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Documents: Top Secret - Owner can read/write -->
    <record id="rule_v2_document_top_secret_owner" model="ir.rule">
      <field name="name">V2: سرية للغاية - المالك يمكنه القراءة والكتابة</field>
      <field name="model_id" ref="mgt_documents.model_document_document"/>
      <field name="domain_force">[
        '&amp;', ('confidentiality_level', '=', 'top_secret'),
        ('create_uid', '=', user.id)
      ]</field>
      <field name="groups" eval="[(4, ref('mgt_documents.group_doc_viewer')), (4, ref('mgt_documents.group_doc_contributor')), (4, ref('mgt_documents.group_doc_approver')), (4, ref('mgt_documents.group_doc_manager'))]"/>
      <field name="perm_read" eval="True"/>
      <field name="perm_write" eval="True"/>
      <field name="perm_create" eval="True"/>
      <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Documents: Top Secret - Recipient can only read -->
    <record id="rule_v2_document_top_secret_recipient" model="ir.rule">
      <field name="name">V2: سرية للغاية - المستلم قراءة فقط</field>
      <field name="model_id" ref="mgt_documents.model_document_document"/>
      <field name="domain_force">[
        '&amp;', ('confidentiality_level', '=', 'top_secret'),
        ('recipient_employee_id.user_id', '=', user.id)
      ]</field>
      <field name="groups" eval="[(4, ref('mgt_documents.group_doc_viewer')), (4, ref('mgt_documents.group_doc_contributor')), (4, ref('mgt_documents.group_doc_approver')), (4, ref('mgt_documents.group_doc_manager'))]"/>
      <field name="perm_read" eval="True"/>
      <field name="perm_write" eval="False"/>
      <field name="perm_create" eval="False"/>
      <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Documents: Admin (full access) -->
    <record id="rule_v2_document_admin_full" model="ir.rule">
      <field name="name">V2: مسؤول - وصول كامل</field>
      <field name="model_id" ref="mgt_documents.model_document_document"/>
      <field name="domain_force">[(1,'=',1)]</field>
      <field name="groups" eval="[(4, ref('mgt_documents.group_doc_admin'))]"/>
    </record>

  </data>
</odoo>
