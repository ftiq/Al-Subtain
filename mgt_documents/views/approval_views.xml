<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <record id="view_approval_request_tree" model="ir.ui.view">
            <field name="name">approval.request.tree</field>
            <field name="model">approval.request</field>
            <field name="arch" type="xml">
                <list string="طلبات الموافقة" default_order="create_date desc" decoration-success="request_status=='approved'" decoration-danger="request_status=='rejected'" decoration-muted="request_status=='cancelled'">
                    <field name="name"/>
                    <field name="document_id"/>
                    <field name="category_id"/>
                    <field name="request_owner_id"/>
                    <field name="request_status" widget="badge"/>
                    <field name="urgency_level"/>
                    <field name="confidentiality_level"/>
                    <field name="department_id"/>
                    <field name="date_start"/>
                    <field name="expected_response_date"/>
                </list>
            </field>
        </record>

        <record id="view_approval_request_form" model="ir.ui.view">
            <field name="name">approval.request.form</field>
            <field name="model">approval.request</field>
            <field name="arch" type="xml">
                <form string="طلب موافقة">
                    <header>
                        <field name="request_status" widget="statusbar" statusbar_visible="new,pending,under_approval,approved,rejected,cancelled"/>

                        <button name="action_smart_assign_approvers" type="object" string="تعيين الموافقين" class="btn-secondary"/>
                        

                        <button name="action_open_my_approve_wizard" type="object" string="موافقة" class="btn-primary"
                                invisible="not is_my_turn or request_status not in ['pending','under_approval']"/>
                        <button name="action_my_refuse" type="object" string="رفض" class="btn-danger"
                                invisible="not is_my_turn or request_status not in ['pending','under_approval']"/>
                        

                        <button name="action_escalate_approval" type="object" string="تصعيد" class="btn-warning"
                                invisible="request_status not in ['pending','under_approval']"/>
                    </header>
                    <sheet>

                        <field name="is_my_turn" invisible="1"/>
                        <field name="is_overdue" invisible="1"/>
                        
                        <group>
                            <group>
                                <field name="name"/>
                                <field name="document_id"/>
                                <field name="category_id"/>
                                <field name="request_owner_id"/>
                                <field name="department_id"/>
                            </group>
                            <group>
                                <field name="urgency_level"/>
                                <field name="confidentiality_level"/>
                                <field name="date_start"/>
                                <field name="expected_response_date"/>
                                <field name="approval_chain_progress" readonly="1"/>
                                <field name="next_approver_info" readonly="1"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="الموافقون">
                                <field name="approver_ids">
                                    <list editable="bottom" string="الموافقون">
                                        <field name="user_id"/>
                                        <field name="employee_id"/>
                                        <field name="status" widget="badge"/>
                                        <field name="sequence"/>
                                        <field name="expected_approval_date"/>
                                        <field name="approval_date"/>
                                        <field name="comment"/>
                                    </list>
                                </field>
                            </page>
                            <page string="المهام المرتبطة">
                                <field name="related_task_ids" readonly="1" widget="one2many_list"/>
                                <field name="tasks_count" readonly="1"/>
                            </page>
                            <page string="التفاصيل">
                                <field name="reason" nolabel="1" widget="text"/>
                                <field name="ai_recommended_approvers" widget="text"/>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="view_approval_request_search" model="ir.ui.view">
            <field name="name">approval.request.search</field>
            <field name="model">approval.request</field>
            <field name="arch" type="xml">
                <search string="بحث طلبات الموافقة">
                    <field name="name"/>
                    <field name="document_id"/>
                    <field name="request_owner_id"/>
                    <filter string="المخصصة لي" name="my_approvals" domain="[('approver_ids.user_id','=',uid)]"/>
                    <filter string="معلقة" name="pending" domain="[('request_status','in',['new','pending','under_approval'])]"/>
                    <filter string="معتمدة" name="approved" domain="[('request_status','=','approved')]"/>
                    <filter string="مرفوضة" name="rejected" domain="[('request_status','=','rejected')]"/>
                </search>
            </field>
        </record>


        <record id="view_approval_category_tree" model="ir.ui.view">
            <field name="name">approval.category.tree</field>
            <field name="model">approval.category</field>
            <field name="arch" type="xml">
                <list string="فئات الموافقة" default_order="sequence asc">
                    <field name="name"/>
                    <field name="description"/>
                    <field name="manager_approval"/>
                    <field name="approver_sequence"/>
                    <field name="sequence"/>
                </list>
            </field>
        </record>

        <record id="view_approval_category_form" model="ir.ui.view">
            <field name="name">approval.category.form</field>
            <field name="model">approval.category</field>
            <field name="arch" type="xml">
                <form string="فئة موافقة">
                    <sheet>
                        <group>
                            <field name="name"/>
                            <field name="description"/>
                            <field name="manager_approval"/>
                            <field name="approver_sequence"/>
                            <field name="sequence"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>


        <record id="view_approval_approver_tree" model="ir.ui.view">
            <field name="name">approval.approver.tree</field>
            <field name="model">approval.approver</field>
            <field name="arch" type="xml">
                <list string="الموافقون" default_order="request_id, sequence">
                    <field name="request_id"/>
                    <field name="user_id"/>
                    <field name="status" widget="badge"/>
                    <field name="sequence"/>
                    <field name="expected_approval_date"/>
                    <field name="approval_date"/>
                </list>
            </field>
        </record>

        <record id="view_approval_approver_form" model="ir.ui.view">
            <field name="name">approval.approver.form</field>
            <field name="model">approval.approver</field>
            <field name="arch" type="xml">
                <form string="ap">
                    <header>
                        <button name="action_approve" type="object" string="موافقة" class="btn-primary"
                                invisible="status not in ['new','pending']"/>
                        <button name="action_refuse" type="object" string="رفض" class="btn-danger"
                                invisible="status not in ['new','pending']"/>
                    </header>
                    <sheet>
                        <group>
                            <group>
                                <field name="request_id"/>
                                <field name="user_id"/>
                                <field name="employee_id"/>
                            </group>
                            <group>
                                <field name="status"/>
                                <field name="sequence"/>
                                <field name="expected_approval_date"/>
                                <field name="approval_date"/>
                            </group>
                        </group>
                        <group>
                            <field name="comment" nolabel="1" widget="text"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
    </data>
</odoo>
