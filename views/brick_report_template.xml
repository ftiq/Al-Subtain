<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- تقرير الطابوق الشامل -->
    <template id="brick_comprehensive_report_template">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="web.external_layout">
                    <div class="page">
                        <div class="oe_structure"/>
                        
                        <!-- رأس التقرير -->
                        <div class="row mt32 mb32">
                            <div class="col-8">
                                <h2><strong>تقرير فحص الطابوق الطيني</strong></h2>
                                <h4>Clay Brick Testing Report</h4>
                            </div>
                            <div class="col-4 text-end">
                                <p><strong>كود العينة:</strong> <span t-field="doc.sample_id.lab_code"/></p>
                                <p><strong>تاريخ الاستلام:</strong> <span t-field="doc.sample_id.received_date"/></p>
                                <p><strong>الطلب:</strong> <span t-field="doc.sample_id.task_id.name"/></p>
                            </div>
                        </div>

                        <!-- معلومات العينة -->
                        <div class="row mb16">
                            <div class="col-6">
                                <table class="table table-sm">
                                    <tr>
                                        <td><strong>المنتج:</strong></td>
                                        <td><span t-field="doc.sample_id.product_id.name"/></td>
                                    </tr>
                                    <tr>
                                        <td><strong>نوع الطابوق:</strong></td>
                                        <td><span t-field="doc.brick_subtype_name"/></td>
                                    </tr>
                                    <tr>
                                        <td><strong>الكمية:</strong></td>
                                        <td><span t-field="doc.sample_id.quantity"/></td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-6">
                                <table class="table table-sm">
                                    <tr>
                                        <td><strong>العميل:</strong></td>
                                        <td><span t-field="doc.sample_id.task_id.partner_id.name"/></td>
                                    </tr>
                                    <tr>
                                        <td><strong>المشروع:</strong></td>
                                        <td><span t-field="doc.sample_id.task_id.project_id.name"/></td>
                                    </tr>
                                    <tr>
                                        <td><strong>الكود الحقلي:</strong></td>
                                        <td><span t-field="doc.sample_id.field_serial"/></td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <!-- جدول 1: قياسات الطابوق المحسوبة -->
                        <t t-set="dimensions_data" t-value="doc.brick_data_ids.filtered(lambda x: x.test_type == 'dimensions')"/>
                        <t t-if="dimensions_data">
                            <div class="row mb32">
                                <div class="col-12">
                                    <h4>جدول (1): قياسات الطابوق</h4>
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr class="table-active">
                                                <th class="text-center">الطول (mm)</th>
                                                <th class="text-center">العرض (mm)</th>
                                                <th class="text-center">الارتفاع (mm)</th>
                                                <th class="text-center">المساحة (mm²)</th>
                                                <th class="text-center">قطر الفتحة (mm)</th>
                                                <th class="text-center">عدد الفتحات</th>
                                                <th class="text-center">نسبة الفتحات (%)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <t t-foreach="dimensions_data" t-as="dim">
                                                <tr>
                                                    <td class="text-center"><span t-field="dim.length_mm"/></td>
                                                    <td class="text-center"><span t-field="dim.width_mm"/></td>
                                                    <td class="text-center"><span t-field="dim.height_mm"/></td>
                                                    <td class="text-center"><span t-field="dim.area_mm2"/></td>
                                                    <td class="text-center"><span t-field="dim.hole_diameter_mm"/></td>
                                                    <td class="text-center"><span t-field="dim.hole_count"/></td>
                                                    <td class="text-center"><span t-field="dim.holes_percentage"/></td>
                                                </tr>
                                            </t>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </t>

                        <!-- جدول 2: فحص مقاومة الانضغاط -->
                        <t t-set="compression_data" t-value="doc.brick_data_ids.filtered(lambda x: x.test_type == 'compression')"/>
                        <t t-if="compression_data">
                            <div class="row mb32">
                                <div class="col-12">
                                    <h4>جدول (2): فحص مقاومة الانضغاط للطابوق الطيني</h4>
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr class="table-active">
                                                <th class="text-center">رقم العينة</th>
                                                <th class="text-center">الحمولة (KN)</th>
                                                <th class="text-center">قوة الضغط (N/mm²)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <t t-foreach="compression_data" t-as="comp">
                                                <tr>
                                                    <td class="text-center"><span t-field="comp.sample_number"/></td>
                                                    <td class="text-center"><span t-field="comp.load_kn"/></td>
                                                    <td class="text-center"><span t-field="comp.compressive_strength"/></td>
                                                </tr>
                                            </t>
                                            <!-- صف المتوسط -->
                                            <tr class="table-warning">
                                                <td class="text-center"><strong>المتوسط</strong></td>
                                                <td class="text-center">-</td>
                                                <td class="text-center"><strong><span t-field="doc.brick_compression_average"/></strong></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </t>

                        <!-- جدول 3: فحص امتصاص الماء -->
                        <t t-set="absorption_data" t-value="doc.brick_data_ids.filtered(lambda x: x.test_type == 'absorption')"/>
                        <t t-if="absorption_data">
                            <div class="row mb32">
                                <div class="col-12">
                                    <h4>جدول (3): فحص امتصاص الماء للطابوق الطيني</h4>
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr class="table-active">
                                                <th class="text-center">رقم العينة</th>
                                                <th class="text-center">الوزن الجاف (gm)</th>
                                                <th class="text-center">الوزن المبلل (gm)</th>
                                                <th class="text-center">نسبة الامتصاص (%)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <t t-foreach="absorption_data" t-as="absorption_sample">
                                                <tr>
                                                    <td class="text-center"><span t-field="absorption_sample.sample_number"/></td>
                                                    <td class="text-center"><span t-field="absorption_sample.dry_weight_gm"/></td>
                                                    <td class="text-center"><span t-field="absorption_sample.wet_weight_gm"/></td>
                                                    <td class="text-center"><span t-field="absorption_sample.absorption_rate"/></td>
                                                </tr>
                                            </t>
                                            <!-- صف المتوسط -->
                                            <tr class="table-warning">
                                                <td class="text-center"><strong>المتوسط</strong></td>
                                                <td class="text-center">-</td>
                                                <td class="text-center">-</td>
                                                <td class="text-center"><strong><span t-field="doc.brick_absorption_average"/></strong></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </t>

                        <!-- جدول 4: حدود المواصفة حسب نوع الطابوق -->
                        <div class="row mb32">
                            <div class="col-12">
                                <h4>جدول (4): حدود المواصفة IQS 24/1988 للطابوق الطيني</h4>
                                <table class="table table-bordered">
                                    <thead>
                                        <tr class="table-active">
                                            <th class="text-center">نوع الطابوق</th>
                                            <th class="text-center">أقل قوة ضغط للعينة الواحدة (N/mm²)</th>
                                            <th class="text-center">متوسط قوة الضغط (N/mm²)</th>
                                            <th class="text-center">أقصى امتصاص للماء (%)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="text-center"><strong>النوع A</strong></td>
                                            <td class="text-center">20.0</td>
                                            <td class="text-center">25.0</td>
                                            <td class="text-center">15.0</td>
                                        </tr>
                                        <tr>
                                            <td class="text-center"><strong>النوع B</strong></td>
                                            <td class="text-center">15.0</td>
                                            <td class="text-center">20.0</td>
                                            <td class="text-center">18.0</td>
                                        </tr>
                                        <tr>
                                            <td class="text-center"><strong>النوع C</strong></td>
                                            <td class="text-center">10.0</td>
                                            <td class="text-center">15.0</td>
                                            <td class="text-center">22.0</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- جدول 5: فحص التزهر -->
                        <t t-set="efflorescence_data" t-value="doc.brick_data_ids.filtered(lambda x: x.test_type == 'efflorescence')"/>
                        <t t-if="efflorescence_data">
                            <div class="row mb32">
                                <div class="col-12">
                                    <h4>جدول (5): فحص التزهر للطابوق الطيني</h4>
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr class="table-active">
                                                <th class="text-center">رقم العينة</th>
                                                <th class="text-center">درجة التزهر</th>
                                                <th class="text-center">التقييم</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <t t-foreach="efflorescence_data" t-as="eff">
                                                <tr>
                                                    <td class="text-center"><span t-field="eff.sample_number"/></td>
                                                    <td class="text-center"><span t-field="eff.efflorescence_degree"/></td>
                                                    <td class="text-center">
                                                        <t t-if="eff.efflorescence_degree == 1">لا يوجد تزهر</t>
                                                        <t t-elif="eff.efflorescence_degree == 2">تزهر طفيف</t>
                                                        <t t-elif="eff.efflorescence_degree == 3">تزهر متوسط</t>
                                                        <t t-elif="eff.efflorescence_degree == 4">تزهر شديد</t>
                                                        <t t-else="">غير محدد</t>
                                                    </td>
                                                </tr>
                                            </t>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </t>

                        <!-- النتائج والتوصيات -->
                        <div class="row mb32">
                            <div class="col-12">
                                <h4>النتائج والتوصيات</h4>
                                <p><strong>النتائج:</strong></p>
                                <ul>
                                    <li>متوسط قوة الضغط: <span t-field="doc.brick_compression_average"/> N/mm²</li>
                                    <li>متوسط نسبة الامتصاص: <span t-field="doc.brick_absorption_average"/>%</li>
                                    <li>عدد العينات المفحوصة: <span t-field="doc.brick_samples_count"/></li>
                                </ul>
                                
                                <p><strong>الخلاصة:</strong></p>
                                <p t-if="doc.brick_subtype_name">
                                    العينة المفحوصة من نوع <span t-field="doc.brick_subtype_name"/> 
                                    وتم فحصها وفقاً للمواصفة العراقية IQS 24/1988.
                                </p>
                            </div>
                        </div>

                        <!-- تذييل التقرير -->
                        <div class="row mt64">
                            <div class="col-6">
                                <p><strong>مهندس الفحص:</strong></p>
                                <br/>
                                <p>_________________________</p>
                                <p>التوقيع والتاريخ</p>
                            </div>
                            <div class="col-6">
                                <p><strong>مدير المختبر:</strong></p>
                                <br/>
                                <p>_________________________</p>
                                <p>التوقيع والتاريخ</p>
                            </div>
                        </div>
                        
                        <div class="oe_structure"/>
                    </div>
                </t>
            </t>
        </t>
    </template>



</odoo>
